//region Core Types and Interfaces

export type Urgency = 'low' | 'medium' | 'high' | 'critical' | 'informational';

export type InsightType =
    'general' | 'predictive' | 'actionable' | 'correlation' | 'anomaly' |
    'sentiment' | 'geospatial' | 'multimedia' | 'risk' | 'opportunity' |
    'efficiency' | 'compliance' | 'market' | 'customer' | 'security' |
    'ethical' | 'resource' | 'sustainability' | 'trend' | 'forecasting' |
    'optimization' | 'recommendation';

export type ActionPriority = 'low' | 'medium' | 'high';

export type ActionStatus = 'pending' | 'in-progress' | 'completed' | 'deferred' | 'cancelled'; // Added 'cancelled'

export type PredictionTrend = 'up' | 'down' | 'stable' | 'unknown'; // Added 'unknown'

export type VisualizationType = 'chart' | 'map' | 'graph' | 'table' | 'gauge' | 'histogram'; // Added 'table', 'gauge', 'histogram'

export type InsightStatus = 'active' | 'archived' | 'dismissed' | 'resolved' | 'pending-review' | 'false-positive'; // Added 'pending-review', 'false-positive'

export interface RelatedEntity {
    type: string;
    id: string;
    name: string;
    url?: string; // Added URL for direct access
    metadata?: { [key: string]: any }; // Added metadata for more context
}

export interface RecommendedAction {
    id: string;
    description: string;
    priority: ActionPriority;
    status: ActionStatus;
    assignedTo?: string; // User ID or role
    dueDate?: string; // ISO string
    impactEstimation?: {
        metric: string;
        value: number;
        unit?: string;
    };
    relatedInsightId?: string; // Link back to original insight if action is standalone
}

export interface Prediction {
    target: string;
    value: number;
    confidence: number;
    trend: PredictionTrend;
    predictionInterval?: [number, number]; // e.g., [lower_bound, upper_bound]
    modelUsed?: string; // Specific model ID for this prediction
    predictionDate?: string; // ISO string when prediction was made
}

export interface Visualization {
    type: VisualizationType;
    data: any; // Can be a URL, base64, or direct JSON data
    options?: any; // Chart.js options, Mapbox options, etc.
    title?: string;
    description?: string;
}

export interface EthicalConsideration {
    aspect: string; // e.g., 'Bias', 'Fairness', 'Transparency', 'Privacy'
    score: number; // e.g., 0-100, lower is better for 'risk' or 'concern'
    details: string;
    mitigationStrategy?: string; // Suggested actions to address the concern
}

export interface Feedback {
    rating: number; // e.g., 1-5 stars, or -1 (dislike), 0 (neutral), 1 (like)
    comment: string;
    timestamp: string; // ISO string
    userId?: string; // ID of the user providing feedback
    category?: 'accuracy' | 'usefulness' | 'clarity' | 'relevance' | 'other';
}

/**
 * Represents an extended AI Insight with detailed properties for display and interaction.
 * This interface is a comprehensive structure for insights generated by an AI system.
 */
export interface ExtendedAIInsight {
    id: string;
    title: string;
    description: string;
    urgency: Urgency;
    type: InsightType;
    timestamp: string; // ISO string (e.g., "2023-10-27T10:00:00Z")
    source: string; // e.g., 'Sales Data', 'Marketing Analytics', 'IoT Sensors'
    dataPoints?: any[]; // Raw data points supporting the insight (can be complex objects)
    metrics?: { [key: string]: any }; // Key metrics related to the insight (e.g., { 'revenueImpact': 12000, 'customerChurnRate': 0.05 })
    relatedEntities?: RelatedEntity[]; // Entities related to the insight (e.g., specific customers, products, regions)
    recommendedActions?: RecommendedAction[]; // Concrete actions suggested by the AI
    predictions?: Prediction[]; // Future predictions associated with the insight
    visualizations?: Visualization[]; // Data for embedding charts, maps, or graphs
    explanation?: string; // Explainable AI (XAI) narrative explaining 'why' the insight was generated
    feedback?: Feedback[]; // User feedback on the insight's accuracy or usefulness
    modelVersion?: string; // Identifier for the AI model version that generated the insight
    ethicalConsiderations?: EthicalConsideration[]; // Assessment of ethical implications
    tags?: string[]; // Categorization tags for filtering and organization
    status?: InsightStatus; // Current status of the insight (e.g., active, resolved, dismissed)
    impactScore?: number; // Calculated numerical score representing the potential impact
    severityScore?: number; // Calculated numerical score representing the severity (e.g., for security or risk insights)
    costEstimation?: number; // Estimated cost associated with the insight (e.g., if unresolved)
    potentialGain?: number; // Estimated gain if recommended actions are taken
    ownerId?: string; // User ID responsible for managing this insight
    lastUpdated?: string; // ISO string of the last modification to the insight
    resolutionNotes?: string; // Notes taken when the insight was resolved
    linkedInsightIds?: string[]; // IDs of other insights related or dependent on this one
}

//endregion

//region Advanced Data & Model Aspects

export type DataPointType = 'numeric' | 'categorical' | 'temporal' | 'geospatial' | 'text' | 'image' | 'video' | 'audio';
export type DataGranularity = 'second' | 'minute' | 'hour' | 'day' | 'week' | 'month' | 'quarter' | 'year';

export interface DataPointMetaData {
    unit?: string;
    sourceField?: string;
    description?: string;
    dataType: DataPointType;
    isSensitive?: boolean;
}

export interface StructuredDataPoint {
    id: string;
    timestamp: string;
    value: any;
    metadata: DataPointMetaData;
}

export interface ModelPerformanceMetrics {
    accuracy?: number;
    precision?: number;
    recall?: number;
    f1Score?: number;
    rocAuc?: number;
    mae?: number; // Mean Absolute Error
    mse?: number; // Mean Squared Error
    rmse?: number; // Root Mean Squared Error
    r2Score?: number; // R-squared
    calibrationError?: number;
    lastEvaluated?: string; // ISO string
}

export interface FeatureImportance {
    featureName: string;
    importanceScore: number; // e.g., SHAP value, permutation importance
    details?: string; // Further explanation if available
}

export interface ExplainabilityDetails {
    method: 'LIME' | 'SHAP' | 'Anchors' | 'PartialDependencePlot' | 'Other';
    summary: string; // High-level explanation
    featureImportances?: FeatureImportance[];
    counterfactuals?: {
        scenario: string;
        description: string;
        impact: string; // How changing features would alter the outcome
    }[];
    visualizations?: Visualization[]; // Visual aids for explanation
}

export type DataQualityIssueType = 'missing_values' | 'outliers' | 'inconsistent_format' | 'duplicates' | 'schema_mismatch' | 'stale_data' | 'privacy_breach';

export interface DataQualityReport {
    timestamp: string; // ISO string
    dataSource: string;
    overallScore: number; // e.g., 0-100
    issuesDetected: {
        type: DataQualityIssueType;
        count: number;
        details?: string;
        impactedFields?: string[];
    }[];
    recommendations?: string[]; // Steps to improve data quality
}

export interface DataDriftDetectionResult {
    timestamp: string; // ISO string
    featureName: string;
    driftScore: number; // e.g., Jensen-Shannon divergence, KS-statistic
    thresholdExceeded: boolean;
    baselinePeriod: string; // e.g., "2023-01-01 to 2023-03-31"
    currentPeriod: string; // e.g., "2023-10-01 to 2023-10-31"
    severity?: Urgency; // How critical is this drift?
    details?: string;
}

//endregion

//region Insight Management & Workflow

export type InsightLifecycleStage = 'generated' | 'under-review' | 'approved' | 'actioned' | 'monitoring' | 'resolved' | 'dismissed';

export interface InsightLifecycleEvent {
    timestamp: string; // ISO string
    stage: InsightLifecycleStage;
    userId?: string; // User who initiated the stage change
    notes?: string;
}

export interface InsightComment {
    id: string;
    userId: string;
    timestamp: string; // ISO string
    text: string;
    replies?: InsightComment[]; // Nested comments
    mentionedUserIds?: string[]; // User IDs mentioned in the comment
}

export type AssignmentType = 'user' | 'team' | 'role';

export interface InsightAssignment {
    assignedToId: string; // User ID, Team ID, or Role ID
    assignmentType: AssignmentType;
    assignedById: string; // User who made the assignment
    timestamp: string; // ISO string
    dueDate?: string; // ISO string
    status: 'assigned' | 'in-progress' | 'completed' | 'overdue';
}

export interface ActionStep {
    id: string;
    description: string;
    status: ActionStatus;
    assignedTo?: string;
    dueDate?: string;
    completionDate?: string; // ISO string
    notes?: string;
}

export interface EnhancedRecommendedAction extends RecommendedAction {
    parentId?: string; // For sub-actions or linked actions
    steps?: ActionStep[];
    justification?: string; // Detailed reason for this action
    dependencies?: string[]; // Other action IDs this action depends on
    costRange?: [number, number]; // Estimated cost range for the action
    timeEstimate?: {
        value: number;
        unit: 'minutes' | 'hours' | 'days' | 'weeks';
    };
    integrationDetails?: IntegrationTrigger; // If action triggers external system
    auditTrail?: InsightLifecycleEvent[]; // History of this specific action
}

export interface InsightHistoryEntry {
    timestamp: string; // ISO string
    userId?: string; // User who made the change, or 'System'
    changeDescription: string;
    details?: {
        field: string;
        oldValue: any;
        newValue: any;
    }[];
}

//endregion

//region User Experience & Personalization

export type NotificationChannel = 'email' | 'slack' | 'in-app' | 'sms' | 'webhook';
export type NotificationFrequency = 'immediate' | 'daily' | 'weekly' | 'monthly';

export interface InsightNotificationSetting {
    userId: string;
    channel: NotificationChannel;
    frequency: NotificationFrequency;
    insightTypes: InsightType[] | 'all'; // Which types to notify for
    urgencyLevels: Urgency[] | 'all'; // Which urgency levels to notify for
    keywords?: string[]; // Notify for insights containing these keywords
    isEnabled: boolean;
}

export type DashboardWidgetType = 'insight_list' | 'summary_metrics' | 'chart' | 'map' | 'action_items' | 'feedback_summary';

export interface DashboardWidgetConfiguration {
    id: string;
    type: DashboardWidgetType;
    title: string;
    position: { x: number; y: number; w: number; h: number }; // Grid position and size
    filters?: InsightFilterCriteria; // Specific filters for this widget
    displayOptions?: any; // e.g., 'sort by urgency', 'show top 5'
    insightType?: InsightType; // If widget is type-specific
}

export interface UserDashboardPreferences {
    userId: string;
    defaultDashboardId?: string;
    widgets: DashboardWidgetConfiguration[];
    lastAccessed?: string; // ISO string
}

export interface UserInsightPreferences {
    userId: string;
    defaultUrgencyFilter?: Urgency[];
    defaultInsightTypeFilter?: InsightType[];
    preferredSorting?: {
        field: keyof ExtendedAIInsight;
        direction: 'asc' | 'desc';
    };
    preferredVisualizations?: VisualizationType[]; // User's preferred visualization types
    autoDismissThreshold?: number; // Automatically dismiss insights older than X days
}

export interface InsightSubscription {
    id: string;
    userId: string;
    insightType: InsightType | 'all';
    urgencyLevel?: Urgency;
    keywords?: string[];
    relatedEntityId?: string; // Subscribe to insights related to a specific entity
    notificationChannels?: NotificationChannel[];
    isActive: boolean;
    createdAt: string; // ISO string
}

//endregion

//region System Configuration & Rules

export type DataConnectorType = 'database' | 'api' | 'file_storage' | 'streaming_platform';
export type DataIngestionFrequency = 'realtime' | 'hourly' | 'daily' | 'weekly';

export interface DataConnectorConfig {
    id: string;
    name: string;
    type: DataConnectorType;
    connectionString: string; // Encrypted or connection details reference
    schemaMapping?: { [sourceField: string]: string }; // Map source fields to internal data model
    ingestionFrequency: DataIngestionFrequency;
    lastIngestion?: string; // ISO string
    status: 'active' | 'inactive' | 'error';
    metadata?: { [key: string]: any }; // e.g., table names, API endpoints
}

export type InsightGenerationTrigger = 'data_ingestion' | 'scheduled' | 'manual' | 'api_call' | 'threshold_breach';

export interface InsightGenerationRule {
    id: string;
    name: string;
    description: string;
    insightType: InsightType;
    urgency: Urgency;
    trigger: InsightGenerationTrigger;
    conditions: {
        metric: string;
        operator: 'gt' | 'lt' | 'eq' | 'gte' | 'lte' | 'ne';
        value: any;
        window?: string; // e.g., '24h', '7d' for time-series conditions
    }[];
    template: {
        title: string;
        description: string;
        recommendations?: string[];
        tags?: string[];
        // Dynamic placeholders allowed for title/description
    };
    isEnabled: boolean;
    createdAt: string; // ISO string
    lastModified: string; // ISO string
    createdBy: string; // User ID
    modelVersionConstraint?: string; // Only use specific model versions
    dataSources?: string[]; // IDs of specific data sources this rule applies to
}

export type IntegrationType = 'action_system' | 'reporting_tool' | 'communication_platform' | 'data_warehouse';

export interface IntegrationConfig {
    id: string;
    name: string;
    type: IntegrationType;
    apiUrl: string;
    apiKey: string; // Encrypted
    status: 'active' | 'inactive' | 'error';
    lastSync?: string; // ISO string
    settings?: { [key: string]: any }; // Specific settings for the integration (e.g., channel IDs for Slack)
}

export interface IntegrationTrigger {
    integrationId: string;
    endpoint: string;
    payloadMapping: { [insightField: string]: string | Function }; // Maps insight fields to integration payload fields
    triggerConditions?: InsightFilterCriteria; // When to trigger this integration
    type: 'automatic' | 'manual'; // Automatic or user-initiated
}

//endregion

//region Reporting & Analytics

export type AggregateFunction = 'count' | 'sum' | 'avg' | 'min' | 'max' | 'p95' | 'p99';

export interface MetricDefinition {
    id: string;
    name: string;
    description: string;
    sourceField: string; // Field from ExtendedAIInsight to aggregate
    aggregateFunction: AggregateFunction;
    filterCriteria?: InsightFilterCriteria; // Specific filters for this metric
    unit?: string;
}

export interface InsightFilterCriteria {
    id?: string | string[];
    title_contains?: string;
    description_contains?: string;
    urgency?: Urgency | Urgency[];
    type?: InsightType | InsightType[];
    source?: string | string[];
    status?: InsightStatus | InsightStatus[];
    tags?: string | string[];
    min_impactScore?: number;
    max_impactScore?: number;
    relatedEntityId?: string | string[];
    min_timestamp?: string; // ISO string
    max_timestamp?: string; // ISO string
    ownerId?: string | string[];
    // Add more granular filters as needed
    customQuery?: string; // For advanced, non-standard filtering
}

export interface InsightGroupingKey {
    field: keyof ExtendedAIInsight | 'custom';
    customLogic?: string; // e.g., 'DATE(timestamp)' for grouping by day
}

export interface AggregateInsightSummary {
    id: string;
    title: string;
    description: string;
    timestamp: string; // ISO string of generation
    period: {
        startDate: string; // ISO string
        endDate: string; // ISO string
        granularity?: DataGranularity;
    };
    filtersApplied: InsightFilterCriteria;
    groupingKeys: InsightGroupingKey[];
    summaryMetrics: {
        totalInsights?: number;
        insightsByUrgency?: { [key in Urgency]?: number };
        insightsByType?: { [key in InsightType]?: number };
        avgImpactScore?: number;
        topTags?: { tag: string; count: number }[];
        // More aggregated metrics
    };
    visualizations?: Visualization[]; // Visualizations summarizing the aggregates
    generatedBy?: string; // User ID or 'System'
}

export type ReportFormat = 'pdf' | 'csv' | 'json' | 'html';

export interface InsightReportDefinition {
    id: string;
    name: string;
    description: string;
    reportFormat: ReportFormat;
    filterCriteria: InsightFilterCriteria;
    aggregationSettings?: {
        groupingKeys: InsightGroupingKey[];
        metrics: MetricDefinition[];
    };
    inclusionOptions?: {
        includeRawInsights?: boolean;
        includeActions?: boolean;
        includeVisualizations?: boolean;
        includeExplanation?: boolean;
    };
    schedule?: {
        frequency: 'daily' | 'weekly' | 'monthly' | 'on_demand';
        time?: string; // HH:MM format for daily/weekly/monthly
        dayOfWeek?: number; // 0-6 for Sunday-Saturday
        dayOfMonth?: number; // 1-31
    };
    recipients?: {
        userIds?: string[];
        emailAddresses?: string[];
        webhookUrls?: string[];
    };
    lastGenerated?: string; // ISO string
    createdBy: string;
    createdAt: string; // ISO string
}

//endregion

//region Ethical AI & Governance

export type BiasDetectionMetric = 'demographic_parity' | 'equalized_odds' | 'disparate_impact' | 'calibration_by_group';

export interface BiasDetectionResult {
    id: string;
    timestamp: string; // ISO string
    modelId: string; // The AI model evaluated
    dataSlice: string; // e.g., 'Gender=Female', 'Age Group=18-24'
    protectedAttribute: string; // The attribute being checked for bias (e.g., 'gender', 'ethnicity')
    metric: BiasDetectionMetric;
    score: number; // The measured value for the metric
    threshold?: number; // Acceptable threshold for the metric
    biasDetected: boolean;
    severity?: Urgency;
    details?: string;
    mitigationRecommendations?: string[];
    visualization?: Visualization; // e.g., a chart showing score distribution across groups
}

export type FairnessPrinciple = 'non-discrimination' | 'transparency' | 'accountability' | 'human_oversight' | 'privacy';

export interface FairnessAssessment {
    timestamp: string; // ISO string
    insightId: string; // Which insight this assessment refers to
    principle: FairnessPrinciple;
    evaluation: 'compliant' | 'partially_compliant' | 'non_compliant' | 'not_applicable';
    score?: number; // Quantitative measure if available
    explanation: string; // Detailed assessment text
    recommendations?: string[];
    assessedBy?: string; // User ID or 'System'
}

export type DataPrivacyClassification = 'public' | 'confidential' | 'restricted' | 'secret';

export interface DataPrivacyCompliance {
    dataPointId: string; // Refers to a specific data point or related entity
    classification: DataPrivacyClassification;
    complianceStandard: string[]; // e.g., ['GDPR', 'HIPAA']
    isCompliant: boolean;
    details: string;
    lastAudited?: string; // ISO string
}

export interface AuditTrailEntry {
    id: string;
    timestamp: string; // ISO string
    userId: string;
    action: string; // e.g., 'Insight_Viewed', 'Insight_Status_Changed', 'Action_Assigned', 'Rule_Modified'
    entityType: 'insight' | 'action' | 'rule' | 'report' | 'user' | 'system_config';
    entityId: string;
    details?: { [key: string]: any }; // Old/New values, parameters, etc.
    ipAddress?: string;
    userAgent?: string;
}

export interface DataRetentionPolicy {
    entityType: 'insight' | 'action' | 'feedback' | 'audit_log' | 'data_point';
    retentionPeriod: {
        value: number;
        unit: 'days' | 'months' | 'years';
    };
    archivalPolicy?: 'soft_delete' | 'hard_delete' | 'anonymize';
    lastEnforced?: string; // ISO string
    isEnabled: boolean;
}

//endregion

//region Utility Types

/**
 * A generic type for parameters that can be a single value or an array of values.
 */
export type MaybeArray<T> = T | T[];

/**
 * Utility type to make all properties optional and nullable.
 */
export type PartialNullable<T> = {
    [P in keyof T]?: T[P] | null;
};

/**
 * A type representing a geographic coordinate.
 */
export interface GeoCoordinate {
    latitude: number;
    longitude: number;
    altitude?: number;
}

/**
 * A type representing a geographic area (e.g., bounding box or polygon).
 */
export type GeoArea = {
    type: 'bbox';
    bbox: [number, number, number, number]; // [west, south, east, north]
} | {
    type: 'polygon';
    coordinates: GeoCoordinate[][]; // Array of rings, first ring is exterior, subsequent are interior (holes)
};

/**
 * Represents the context from which an insight was requested or viewed.
 */
export interface InsightContext {
    userId?: string;
    dashboardId?: string;
    reportId?: string;
    sourceApp?: string; // e.g., 'web-app', 'mobile-app', 'api'
    sessionId?: string;
    ipAddress?: string;
    location?: GeoCoordinate;
}

//endregion