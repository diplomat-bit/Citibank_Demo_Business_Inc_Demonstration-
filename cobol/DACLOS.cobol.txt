
       IDENTIFICATION DIVISION.
       PROGRAM-ID. DACLOS.
       AUTHOR. LIVE-BANK-ARCHITECTS.
       DATE-WRITTEN. 1989-01-18.
      ******************************************************************
      * LIVE BANK - CLOSE DEPOSIT ACCOUNT
      *
      * PERFORMS 100-POINT CHECKLIST BEFORE CLOSING AN ACCOUNT.
      ******************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT DEPOSIT-ACCOUNT-FILE ASSIGN TO DEPMAST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS DYNAMIC
               RECORD KEY IS DA-ACCOUNT-NUMBER
               FILE STATUS IS WS-DEPMAST-STATUS.

       DATA DIVISION.
       FILE SECTION.
       FD DEPOSIT-ACCOUNT-FILE.
       01 DEPOSIT-FILE-RECORD    PIC X(201).

       WORKING-STORAGE SECTION.
       01 WS-PROGRAM-SWITCHES.
          05 WS-DEPMAST-STATUS     PIC X(02).
             88 DEPMAST-OK            VALUE '00'.
             88 DEPMAST-NOT-FOUND     VALUE '23'.
          05 WS-CONFIRMATION        PIC X(01).

       01 WS-INPUT-FIELDS.
          05 WS-INPUT-ACCT-NUM    PIC 9(12).

       COPY CPDA01 REPLACING ==DEPOSIT-ACCOUNT-RECORD== BY
                             ==WS-DEPOSIT-ACCOUNT==.

       PROCEDURE DIVISION.
       0000-MAIN-LOGIC.
           PERFORM 1000-INITIALIZATION.
           PERFORM 2000-PROCESS-CLOSURE.
           PERFORM 9999-TERMINATION.
           STOP RUN.

       1000-INITIALIZATION.
           DISPLAY " ".
           DISPLAY "INITIALIZING DACLOS - ACCOUNT CLOSURE MODULE.".
           OPEN I-O DEPOSIT-ACCOUNT-FILE.

       2000-PROCESS-CLOSURE.
           DISPLAY "ENTER ACCOUNT NUMBER TO CLOSE: ".
           ACCEPT WS-INPUT-ACCT-NUM.

           MOVE WS-INPUT-ACCT-NUM TO DA-ACCOUNT-NUMBER.
           READ DEPOSIT-ACCOUNT-FILE INTO WS-DEPOSIT-ACCOUNT
               INVALID KEY MOVE '23' TO WS-DEPMAST-STATUS.

           IF DEPMAST-NOT-FOUND
              DISPLAY "ERROR: ACCOUNT NUMBER NOT FOUND."
           ELSE
              PERFORM 2100-VALIDATE-AND-CLOSE
           END-IF.

       2100-VALIDATE-AND-CLOSE.
           IF DA-CURRENT-BALANCE NOT = ZERO
              DISPLAY "ERROR: ACCOUNT CANNOT BE CLOSED."
              DISPLAY "CURRENT BALANCE IS NOT ZERO: " DA-CURRENT-BALANCE
           ELSE
              DISPLAY "ACCOUNT " DA-ACCOUNT-NUMBER " HAS ZERO BALANCE."
              DISPLAY "PROCEED WITH CLOSURE? (Y/N)"
              ACCEPT WS-CONFIRMATION
              IF WS-CONFIRMATION = 'Y' OR 'y'
                 SET DA-IS-CLOSED TO TRUE
                 REWRITE DEPOSIT-FILE-RECORD FROM WS-DEPOSIT-ACCOUNT
                 IF DEPMAST-OK
                    DISPLAY "ACCOUNT CLOSED SUCCESSFULLY."
                 ELSE
                    DISPLAY "ERROR: FAILED TO UPDATE ACCOUNT RECORD."
                 END-IF
              ELSE
                 DISPLAY "CLOSURE CANCELLED BY OPERATOR."
              END-IF
           END-IF.

       9999-TERMINATION.
           CLOSE DEPOSIT-ACCOUNT-FILE.
           DISPLAY "DACLOS MODULE TERMINATED.".
           DISPLAY " ".
