       IDENTIFICATION DIVISION.
       PROGRAM-ID. CIINQ.
       DATE-WRITTEN. 1988-10-18.
      ******************************************************************
      * CUSTOMER INQUIRY MODULE
      *
      * RETRIEVES AND DISPLAYS A CUSTOMER RECORD FROM THE MASTER FILE
      * BASED ON THE CUSTOMER ID. 100% READ-ONLY OPERATION.
      * ENHANCED WITH IDGAFAI (DISCIPLINED ANALYSIS SYSTEM) INSIGHTS.
      * This module provides a comprehensive view of customer data,
      * including basic profile information, account summaries, and
      * AI-generated insights characterized by clarity, evidence-based
      * findings, and actionable, non-mystical recommendations.
      ******************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT CUSTOMER-MASTER-FILE ASSIGN TO CUSTMAST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS RANDOM
               RECORD KEY IS CM-CUSTOMER-ID
               FILE STATUS IS WS-CUSTMAST-STATUS.

       DATA DIVISION.
       FILE SECTION.
       FD CUSTOMER-MASTER-FILE.
       01 CUSTOMER-FILE-RECORD    PIC X(434).

       WORKING-STORAGE SECTION.
       01 WS-PROGRAM-SWITCHES.
          05 WS-CUSTMAST-STATUS     PIC X(02).
             88 CUSTMAST-OK            VALUE '00'.
             88 CUSTMAST-NOT-FOUND     VALUE '23'.
             88 CUSTMAST-OPEN-ERROR    VALUE '35', '39'. *> For file open errors
          05 WS-AI-PROCESS-STATUS   PIC X(02).
             88 AI-PROCESS-OK          VALUE '00'.
             88 AI-PROCESS-FAILED      VALUE '01'.
          05 WS-USER-CHOICE         PIC X(01).
             88 CHOICE-BASIC-DETAILS   VALUE '1'.
             88 CHOICE-AI-INSIGHTS     VALUE '2'.
             88 CHOICE-FULL-PROFILE    VALUE '3'.
             88 CHOICE-EXIT            VALUE 'X', 'x'.
          05 WS-INQUIRY-ABORTED-SW  PIC X(01) VALUE 'N'.
             88 INQUIRY-ABORTED        VALUE 'Y'.

       01 WS-INPUT-FIELDS.
          05 WS-INQUIRY-ID        PIC 9(10).

       COPY CPCI01 REPLACING ==CUSTOMER-MASTER-RECORD== BY
                               ==WS-CUSTOMER-MASTER==.

       *> New fields for expanded customer data (simulated as if part of
       *> or derived from WS-CUSTOMER-MASTER or other data sources).
       01 WS-ADDITIONAL-CUSTOMER-DATA.
          05 WS-ACCOUNT-BALANCE     PIC S9(13)V99.
          05 WS-LAST-TRANSACTION-DATE PIC 9(08). *> YYYYMMDD
          05 WS-LAST-TRANSACTION-AMT  PIC S9(11)V99.
          05 WS-TOTAL-TRANSACTIONS  PIC 9(05).
          05 WS-CUSTOMER-SEGMENT    PIC X(20). *> E.g., 'Premium', 'Standard', 'Emerging'
          05 WS-PREF-COMM-CHANNEL   PIC X(10). *> E.g., 'EMAIL', 'PHONE', 'SMS'
          05 WS-ENROLLMENT-DATE     PIC 9(08). *> YYYYMMDD

       *> New fields for AI-generated insights
       01 WS-AI-INSIGHTS-DATA.
          05 WS-AI-PERSONALIZED-MESSAGE PIC X(120).
          05 WS-AI-NEXT-BEST-ACTION   PIC X(100).
          05 WS-AI-CHURN-PROBABILITY  PIC 9(03). *> 000-100
          05 WS-AI-LIFETIME-VALUE     PIC S9(13)V99.
          05 WS-AI-SENTIMENT-SCORE    PIC S9(03). *> -100 to +100
          05 WS-AI-PRODUCT-RECOMMEND  PIC X(80).

       01 WS-DISPLAY-SCREEN.
          05 DISP-LINE-1.
             10 FILLER            PIC X(10) VALUE "CUSTOMER: ".
             10 DISP-CUST-ID      PIC 9(10).
             10 FILLER            PIC X(02) VALUE " ".
             10 DISP-CUST-NAME    PIC X(50).
          05 DISP-LINE-2.
             10 FILLER            PIC X(10) VALUE "ADDRESS: ".
             10 DISP-ADDR         PIC X(70).
          05 DISP-LINE-3.
             10 FILLER            PIC X(10) VALUE "STATUS: ".
             10 DISP-STATUS       PIC X(10).
             10 FILLER            PIC X(05) VALUE "RISK: ".
             10 DISP-RISK         PIC 999.
          05 DISP-LINE-4.
             10 FILLER            PIC X(10) VALUE "SEGMENT: ".
             10 DISP-SEGMENT      PIC X(20).
             10 FILLER            PIC X(05) VALUE "PREF: ".
             10 DISP-PREF-CHANNEL PIC X(10).
          05 DISP-LINE-5.
             10 FILLER            PIC X(10) VALUE "BALANCE: ".
             10 DISP-BALANCE      PIC $$,$$$,$$$,$$9.99.
             10 FILLER            PIC X(05) VALUE "LAST TX: ".
             10 DISP-LAST-TX-DATE PIC 99/99/9999.
             10 FILLER            PIC X(03) VALUE "AMT: ".
             10 DISP-LAST-TX-AMT  PIC $$,$$$,$$9.99.
          05 DISP-LINE-6.
             10 FILLER            PIC X(10) VALUE "TX COUNT: ".
             10 DISP-TX-COUNT     PIC 9(05).
             10 FILLER            PIC X(05) VALUE "ENROLL: ".
             10 DISP-ENROLL-DATE  PIC 99/99/9999.

       01 WS-AI-DISPLAY-SCREEN.
          05 AI-DISP-LINE-1.
             10 FILLER            PIC X(20) VALUE "AI INSIGHTS FOR: ".
             10 AI-DISP-CUST-ID   PIC 9(10).
          05 AI-DISP-LINE-2.
             10 FILLER            PIC X(20) VALUE "MESSAGE: ".
             10 AI-DISP-MESSAGE   PIC X(120).
          05 AI-DISP-LINE-3.
             10 FILLER            PIC X(20) VALUE "NEXT BEST ACTION: ".
             10 AI-DISP-NBA       PIC X(100).
          05 AI-DISP-LINE-4.
             10 FILLER            PIC X(20) VALUE "CHURN PROBABILITY: ".
             10 AI-DISP-CHURN     PIC 9(03).
             10 FILLER            PIC X(01) VALUE "%".
             10 FILLER            PIC X(05) VALUE " LTV: ".
             10 AI-DISP-LTV       PIC $$,$$$,$$$,$$9.99.
          05 AI-DISP-LINE-5.
             10 FILLER            PIC X(20) VALUE "SENTIMENT SCORE: ".
             10 AI-DISP-SENTIMENT PIC Z99.
             10 FILLER            PIC X(05) VALUE " PROD: ".
             10 AI-DISP-PRODUCT   PIC X(80).

       PROCEDURE DIVISION.
       0000-MAIN-LOGIC.
           PERFORM 1000-INITIALIZATION.
           PERFORM 2000-ACCEPT-INQUIRY-ID.
           IF NOT INQUIRY-ABORTED
              PERFORM 3000-READ-CUSTOMER-RECORD
              IF CUSTMAST-OK
                 PERFORM 2500-PROCESS-AI-INSIGHTS
                 PERFORM 4000-DISPLAY-MENU-AND-DETAILS
              ELSE
                 DISPLAY "NO FURTHER ACTION FOR INVALID CUSTOMER ID."
              END-IF
           END-IF.
           PERFORM 9999-TERMINATION.
           STOP RUN.

       1000-INITIALIZATION.
           DISPLAY " ".
           DISPLAY "INITIALIZING CIINQ - CUSTOMER INQUIRY MODULE.".
           OPEN INPUT CUSTOMER-MASTER-FILE.
           IF NOT CUSTMAST-OK
              DISPLAY "CRITICAL ERROR OPENING CUSTOMER MASTER FILE."
              DISPLAY "FILE STATUS: " WS-CUSTMAST-STATUS
              MOVE 'Y' TO WS-INQUIRY-ABORTED-SW
              EXIT PARAGRAPH
           END-IF.
           MOVE SPACES TO WS-AI-PERSONALIZED-MESSAGE
                           WS-AI-NEXT-BEST-ACTION
                           WS-AI-PRODUCT-RECOMMEND.
           MOVE ZEROS TO WS-AI-CHURN-PROBABILITY
                         WS-AI-LIFETIME-VALUE
                         WS-AI-SENTIMENT-SCORE
                         WS-ACCOUNT-BALANCE
                         WS-LAST-TRANSACTION-DATE
                         WS-LAST-TRANSACTION-AMT
                         WS-TOTAL-TRANSACTIONS
                         WS-ENROLLMENT-DATE.
           MOVE '00' TO WS-AI-PROCESS-STATUS.
           MOVE 'N' TO WS-INQUIRY-ABORTED-SW.

       2000-ACCEPT-INQUIRY-ID.
           DISPLAY " ".
           DISPLAY "ENTER CUSTOMER ID FOR INQUIRY (10 DIGITS, 0 TO EXIT): ".
           ACCEPT WS-INQUIRY-ID.
           IF WS-INQUIRY-ID = ZEROS
              DISPLAY "INQUIRY ABORTED BY USER."
              MOVE 'Y' TO WS-INQUIRY-ABORTED-SW
           END-IF.

       2500-PROCESS-AI-INSIGHTS.
      ******************************************************************
      * This section simulates calling the idgafAI Analysis System.
      * idgafAI's operational principles (clarity, evidence-first,
      * no mystique) govern the expected structure and tone of insights.
      * In a real system, this would CALL an external service or program.
      ******************************************************************
           DISPLAY " ".
           DISPLAY "ACTIVATING IDGAFAI ANALYSIS SYSTEM...".
           *> Simulate AI processing based on customer data.
           *> This logic would be much more complex in a real AI engine.
           EVALUATE TRUE
               WHEN CM-AI-RISK-SCORE OF WS-CUSTOMER-MASTER < 30
                   MOVE "Customer is a highly valued and engaged individual. High potential for long-term loyalty." TO WS-AI-PERSONALIZED-MESSAGE
                   MOVE "Proactively offer new premium service features and exclusive benefits." TO WS-AI-NEXT-BEST-ACTION
                   MOVE 005 TO WS-AI-CHURN-PROBABILITY
                   MOVE 150000.00 TO WS-AI-LIFETIME-VALUE
                   MOVE 085 TO WS-AI-SENTIMENT-SCORE
                   MOVE 'Advanced Financial Planning Tool' TO WS-AI-PRODUCT-RECOMMEND
                   MOVE 'Premium' TO WS-CUSTOMER-SEGMENT
                   MOVE 'EMAIL' TO WS-PREF-COMM-CHANNEL
                   MOVE 20180515 TO WS-ENROLLMENT-DATE
               WHEN CM-AI-RISK-SCORE OF WS-CUSTOMER-MASTER < 70
                   MOVE "Customer shows stable engagement. There is opportunity for deeper relationship building." TO WS-AI-PERSONALIZED-MESSAGE
                   MOVE "Suggest personalized financial wellness resources and explore additional product needs." TO WS-AI-NEXT-BEST-ACTION
                   MOVE 025 TO WS-AI-CHURN-PROBABILITY
                   MOVE 75000.00 TO WS-AI-LIFETIME-VALUE
                   MOVE 040 TO WS-AI-SENTIMENT-SCORE
                   MOVE 'Investment Starter Pack' TO WS-AI-PRODUCT-RECOMMEND
                   MOVE 'Standard' TO WS-CUSTOMER-SEGMENT
                   MOVE 'SMS' TO WS-PREF-COMM-CHANNEL
                   MOVE 20200821 TO WS-ENROLLMENT-DATE
               WHEN OTHER
                   MOVE "Customer engagement is low, indicating potential churn risk. Immediate outreach is recommended." TO WS-AI-PERSONALIZED-MESSAGE
                   MOVE "Initiate a proactive retention campaign with a personalized support call and special offer." TO WS-AI-NEXT-BEST-ACTION
                   MOVE 070 TO WS-AI-CHURN-PROBABILITY
                   MOVE 25000.00 TO WS-AI-LIFETIME-VALUE
                   MOVE -030 TO WS-AI-SENTIMENT-SCORE
                   MOVE 'Customer Loyalty Program Enrollment' TO WS-AI-PRODUCT-RECOMMEND
                   MOVE 'Emerging' TO WS-CUSTOMER-SEGMENT
                   MOVE 'PHONE' TO WS-PREF-COMM-CHANNEL
                   MOVE 20220110 TO WS-ENROLLMENT-DATE
           END-EVALUATE.

           *> Simulate some basic account data for display, often retrieved from other systems.
           MOVE (FUNCTION RANDOM(FUNCTION SECONDS-FROM-MIDNIGHT) * 10000000) + 1000.00
                TO WS-ACCOUNT-BALANCE
           MOVE FUNCTION CURRENT-DATE (1:8) TO WS-LAST-TRANSACTION-DATE
           MOVE (FUNCTION RANDOM(FUNCTION SECONDS-FROM-MIDNIGHT) * 500) + 10.00
                TO WS-LAST-TRANSACTION-AMT
           MOVE (FUNCTION RANDOM(FUNCTION SECONDS-FROM-MIDNIGHT) * 1000) + 50
                TO WS-TOTAL-TRANSACTIONS

           DISPLAY "IDGAFAI ANALYSIS SYSTEM PROCESSING COMPLETE."
           MOVE '00' TO WS-AI-PROCESS-STATUS. *> Indicate successful AI processing.

       3000-READ-CUSTOMER-RECORD.
           MOVE WS-INQUIRY-ID TO CM-CUSTOMER-ID OF WS-CUSTOMER-MASTER.
           READ CUSTOMER-MASTER-FILE INTO WS-CUSTOMER-MASTER
               KEY IS CM-CUSTOMER-ID OF WS-CUSTOMER-MASTER
               INVALID KEY
                   MOVE '23' TO WS-CUSTMAST-STATUS
           END-READ.
           IF CUSTMAST-NOT-FOUND
              DISPLAY "ERROR: CUSTOMER ID '" WS-INQUIRY-ID "' NOT FOUND ON MASTER FILE."
           ELSE
              DISPLAY "RECORD RETRIEVED FOR ID: " WS-INQUIRY-ID
           END-IF.

       4000-DISPLAY-MENU-AND-DETAILS.
           PERFORM 4100-MOVE-COMMON-DISPLAY-FIELDS.
           PERFORM UNTIL CHOICE-EXIT
               PERFORM 4010-DISPLAY-OPTIONS-MENU
               ACCEPT WS-USER-CHOICE
               EVALUATE WS-USER-CHOICE
                   WHEN CHOICE-BASIC-DETAILS
                       PERFORM 4200-DISPLAY-BASIC-CUSTOMER-DATA
                   WHEN CHOICE-AI-INSIGHTS
                       PERFORM 4300-DISPLAY-AI-INSIGHTS
                   WHEN CHOICE-FULL-PROFILE
                       PERFORM 4200-DISPLAY-BASIC-CUSTOMER-DATA
                       PERFORM 4300-DISPLAY-AI-INSIGHTS
                   WHEN CHOICE-EXIT
                       DISPLAY "EXITING CUSTOMER DETAILS VIEW."
                   WHEN OTHER
                       DISPLAY "INVALID CHOICE. PLEASE TRY AGAIN."
               END-EVALUATE
           END-PERFORM.

       4010-DISPLAY-OPTIONS-MENU.
           DISPLAY " ".
           DISPLAY "----------------- CUSTOMER VIEW OPTIONS -----------------".
           DISPLAY "1. VIEW BASIC CUSTOMER DETAILS".
           DISPLAY "2. VIEW AI-GENERATED INSIGHTS".
           DISPLAY "3. VIEW FULL CUSTOMER PROFILE (BASIC + AI)".
           DISPLAY "X. EXIT TO MAIN MENU".
           DISPLAY "----------------------------------------------------".
           DISPLAY "ENTER YOUR CHOICE: ".

       4100-MOVE-COMMON-DISPLAY-FIELDS.
           MOVE CM-CUSTOMER-ID OF WS-CUSTOMER-MASTER TO DISP-CUST-ID.
           STRING CM-FIRST-NAME OF WS-CUSTOMER-MASTER DELIMITED BY '  '
                  " " DELIMITED BY SIZE
                  CM-LAST-NAME OF WS-CUSTOMER-MASTER DELIMITED BY '  '
                  INTO DISP-CUST-NAME.
           MOVE CM-ADDR1-LINE1 OF WS-CUSTOMER-MASTER TO DISP-ADDR.
           EVALUATE CM-STATUS OF WS-CUSTOMER-MASTER
               WHEN 'A' MOVE 'ACTIVE' TO DISP-STATUS
               WHEN 'D' MOVE 'DORMANT' TO DISP-STATUS
               WHEN 'C' MOVE 'CLOSED' TO DISP-STATUS
               WHEN OTHER MOVE 'UNKNOWN' TO DISP-STATUS
           END-EVALUATE.
           MOVE CM-AI-RISK-SCORE OF WS-CUSTOMER-MASTER TO DISP-RISK.

           *> Move additional data
           MOVE WS-CUSTOMER-SEGMENT TO DISP-SEGMENT.
           MOVE WS-PREF-COMM-CHANNEL TO DISP-PREF-CHANNEL.
           MOVE WS-ACCOUNT-BALANCE TO DISP-BALANCE.
           MOVE WS-LAST-TRANSACTION-DATE (5:2) TO DISP-LAST-TX-DATE (1:2).
           MOVE WS-LAST-TRANSACTION-DATE (7:2) TO DISP-LAST-TX-DATE (4:2).
           MOVE WS-LAST-TRANSACTION-DATE (1:4) TO DISP-LAST-TX-DATE (7:4).
           MOVE WS-LAST-TRANSACTION-AMT TO DISP-LAST-TX-AMT.
           MOVE WS-TOTAL-TRANSACTIONS TO DISP-TX-COUNT.
           MOVE WS-ENROLLMENT-DATE (5:2) TO DISP-ENROLL-DATE (1:2).
           MOVE WS-ENROLLMENT-DATE (7:2) TO DISP-ENROLL-DATE (4:2).
           MOVE WS-ENROLLMENT-DATE (1:4) TO DISP-ENROLL-DATE (7:4).

       4200-DISPLAY-BASIC-CUSTOMER-DATA.
           DISPLAY " ".
           DISPLAY "----------------- BASIC CUSTOMER DETAILS -----------------".
           DISPLAY DISP-LINE-1.
           DISPLAY DISP-LINE-2.
           DISPLAY DISP-LINE-3.
           DISPLAY DISP-LINE-4.
           DISPLAY DISP-LINE-5.
           DISPLAY DISP-LINE-6.
           DISPLAY "----------------------------------------------------".

       4300-DISPLAY-AI-INSIGHTS.
           IF NOT AI-PROCESS-OK
              DISPLAY "AI INSIGHTS ARE NOT AVAILABLE FOR CUSTOMER ID: "
              CM-CUSTOMER-ID OF WS-CUSTOMER-MASTER
              DISPLAY "COGNITIVE ENGINE STATUS: " WS-AI-PROCESS-STATUS
              EXIT PARAGRAPH
           END-IF.

           MOVE CM-CUSTOMER-ID OF WS-CUSTOMER-MASTER TO AI-DISP-CUST-ID.
           MOVE WS-AI-PERSONALIZED-MESSAGE TO AI-DISP-MESSAGE.
           MOVE WS-AI-NEXT-BEST-ACTION TO AI-DISP-NBA.
           MOVE WS-AI-CHURN-PROBABILITY TO AI-DISP-CHURN.
           MOVE WS-AI-LIFETIME-VALUE TO AI-DISP-LTV.
           MOVE WS-AI-SENTIMENT-SCORE TO AI-DISP-SENTIMENT.
           MOVE WS-AI-PRODUCT-RECOMMEND TO AI-DISP-PRODUCT.

           DISPLAY " ".
           DISPLAY "------------- IDGAFAI ANALYSIS INSIGHTS -------------".
           DISPLAY AI-DISP-LINE-1.
           DISPLAY AI-DISP-LINE-2.
           DISPLAY AI-DISP-LINE-3.
           DISPLAY AI-DISP-LINE-4.
           DISPLAY AI-DISP-LINE-5.
           DISPLAY "----------------------------------------------------".

       9999-TERMINATION.
           IF NOT CUSTMAST-OPEN-ERROR
              CLOSE CUSTOMER-MASTER-FILE
           END-IF.
           DISPLAY "CIINQ MODULE TERMINATED.".
           DISPLAY " ".
