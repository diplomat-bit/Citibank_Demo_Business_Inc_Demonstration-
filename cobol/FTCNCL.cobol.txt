
       IDENTIFICATION DIVISION.
       PROGRAM-ID. FTCNCL.
       AUTHOR. LIVE-BANK-ARCHITECTS.
       DATE-WRITTEN. 1993-02-12.
      ******************************************************************
      * LIVE BANK - CANCEL PENDING FUNDS TRANSFER
      *
      * REQUIRES 100-POINT VERIFICATION BEFORE CANCELLATION.
      ******************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT FUNDS-TRANSFER-FILE ASSIGN TO FTMAST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS DYNAMIC
               RECORD KEY IS FT-TRANSACTION-ID
               FILE STATUS IS WS-FTMAST-STATUS.

       DATA DIVISION.
       FILE SECTION.
       FD FUNDS-TRANSFER-FILE.
       01 FT-FILE-RECORD         PIC X(200).

       WORKING-STORAGE SECTION.
       01 WS-PROGRAM-SWITCHES.
          05 WS-FTMAST-STATUS       PIC X(02).
             88 FTMAST-OK            VALUE '00'.
             88 FTMAST-NOT-FOUND     VALUE '23'.
          05 WS-CONFIRMATION        PIC X(01).

       01 WS-INPUT-FIELDS.
          05 WS-CANCEL-TX-ID        PIC X(16).

       COPY CPFT01 REPLACING ==FUNDS-TRANSFER-RECORD== BY
                             ==WS-FUNDS-TRANSFER==.

       PROCEDURE DIVISION.
       0000-MAIN-LOGIC.
           PERFORM 1000-INITIALIZATION.
           PERFORM 2000-PROCESS-CANCELLATION.
           PERFORM 9999-TERMINATION.
           STOP RUN.

       1000-INITIALIZATION.
           DISPLAY " ".
           DISPLAY "INITIALIZING FTCNCL - TRANSFER CANCELLATION MODULE.".
           OPEN I-O FUNDS-TRANSFER-FILE.

       2000-PROCESS-CANCELLATION.
           DISPLAY "ENTER TRANSACTION ID TO CANCEL: ".
           ACCEPT WS-CANCEL-TX-ID.

           MOVE WS-CANCEL-TX-ID TO FT-TRANSACTION-ID.
           READ FUNDS-TRANSFER-FILE INTO WS-FUNDS-TRANSFER
               INVALID KEY MOVE '23' TO WS-FTMAST-STATUS.

           IF FTMAST-NOT-FOUND
              DISPLAY "ERROR: TRANSACTION ID NOT FOUND."
           ELSE
              PERFORM 2100-VALIDATE-AND-CANCEL
           END-IF.

       2100-VALIDATE-AND-CANCEL.
           IF NOT FT-PENDING
              DISPLAY "ERROR: TRANSFER CANNOT BE CANCELLED."
              DISPLAY "CURRENT STATUS IS NOT 'PENDING'."
           ELSE
              DISPLAY "TRANSFER FOUND. AMOUNT: " FT-TRANSFER-AMOUNT
              DISPLAY "CANCEL THIS TRANSFER? (Y/N)"
              ACCEPT WS-CONFIRMATION
              IF WS-CONFIRMATION = 'Y' OR 'y'
                 SET FT-CANCELLED TO TRUE
                 MOVE "CANCELLED BY OPERATOR" TO FT-STATUS-REASON
                 REWRITE FT-FILE-RECORD FROM WS-FUNDS-TRANSFER
                 IF FTMAST-OK
                    DISPLAY "TRANSFER CANCELLED SUCCESSFULLY."
                 ELSE
                    DISPLAY "ERROR: FAILED TO UPDATE RECORD."
                 END-IF
              ELSE
                 DISPLAY "CANCELLATION ABORTED."
              END-IF
           END-IF.

       9999-TERMINATION.
           CLOSE FUNDS-TRANSFER-FILE.
           DISPLAY "FTCNCL MODULE TERMINATED.".
           DISPLAY " ".
