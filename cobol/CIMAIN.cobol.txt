       IDENTIFICATION DIVISION.
       PROGRAM-ID. CIMAIN.
       AUTHOR. INSTITUTION-DEVELOPMENT-TEAM.
       DATE-WRITTEN. 2024-07-27.
      ******************************************************************
      * FINANCIAL INSTITUTION - CUSTOMER INFORMATION SYSTEM MAIN
      *
      * THIS IS THE SUB-MENU CONTROLLER FOR THE CUSTOMER INFORMATION
      * SYSTEM (CIS). IT PROVIDES ACCESS TO ALL CORE CIS FUNCTIONS
      * AND INTEGRATED ADVANCED ANALYTICS CAPABILITIES.
      * Ensures robust customer data management and service delivery.
      * The system aims to provide a seamless and intelligent interface
      * for managing customer profiles, supporting human agents with
      * cognitive insights derived from integrated AI modules. This
      * integration focuses on enhancing operational efficiency and
      * customer satisfaction through non-controversial, value-added
      * analytical support.
      ******************************************************************
       ENVIRONMENT DIVISION.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01 WS-MENU-SWITCHES.
          05 WS-USER-CHOICE       PIC X(01).
             88 EXIT-CI-MENU      VALUE 'X'.
          05 WS-VALID-CHOICE-FLAG PIC X(01) VALUE 'N'.
             88 VALID-CHOICE      VALUE 'Y'.
             88 INVALID-CHOICE    VALUE 'N'.

       01 WS-PROGRAM-MESSAGES.
          05 WS-MSG-INVALID-CHOICE PIC X(70) VALUE "INVALID SELECTION. PLEASE ENTER A VALID OPTION (1-8, X).".
          05 WS-MSG-EXITING        PIC X(70) VALUE "RETURNING TO MAIN MENU... SYSTEM LOGGING OFF.".
          05 WS-MSG-PRESS-ENTER    PIC X(70) VALUE "PRESS ENTER TO CONTINUE...".
          05 WS-MSG-PROCESSING     PIC X(70) VALUE "PROCESSING REQUEST... PLEASE WAIT.".
          05 WS-MSG-ENTER-CUST-ID  PIC X(70) VALUE "ENTER CUSTOMER ID (10 DIGITS): ".
          05 WS-MSG-INVALID-CUST-ID PIC X(70) VALUE "INVALID CUSTOMER ID. MUST BE 10 NUMERIC DIGITS.".
          05 WS-MSG-NO-AI-INSIGHTS PIC X(70) VALUE "No specific AI insights available for this customer at this time.".
          05 WS-MSG-AI-LEARNING    PIC X(70) VALUE "Cognitive Analytics Engine is continuously learning and updating.".


       01 WS-CUSTOMER-DATA-AREA.
          05 WS-CUSTOMER-ID       PIC 9(10). *> For passing customer ID to sub-programs.

       01 WS-INPUT-VALIDATION-AREA.
          05 WS-TEMP-CUSTOMER-ID  PIC X(10). *> Used for raw customer ID input before validation.

       01 WS-AI-INSIGHTS-DATA.
          05 WS-AI-SUMMARY-LINE1  PIC X(70).
          05 WS-AI-SUMMARY-LINE2  PIC X(70).
          05 WS-AI-SUMMARY-LINE3  PIC X(70).
          05 WS-AI-SUMMARY-LINE4  PIC X(70).

       01 WS-MENU-SCREEN.
          05 FILLER PIC X(80) VALUE ALL "*".
          05 FILLER PIC X(80) VALUE
             "*          CUSTOMER INFORMATION SYSTEM (CIS)           *".
          05 FILLER PIC X(80) VALUE ALL "*".
          05 FILLER PIC X(80) VALUE "*                                                    *".
          05 FILLER PIC X(80) VALUE "*   1. ADD NEW CUSTOMER                              *".
          05 FILLER PIC X(80) VALUE "*   2. INQUIRE CUSTOMER RECORD                       *".
          05 FILLER PIC X(80) VALUE "*   3. UPDATE CUSTOMER RECORD                        *".
          05 FILLER PIC X(80) VALUE "*   4. DELETE CUSTOMER RECORD                        *".
          05 FILLER PIC X(80) VALUE "*                                                    *".
          05 FILLER PIC X(80) VALUE "*   5. AI-ASSISTED CUSTOMER INSIGHTS                 *".
          05 FILLER PIC X(80) VALUE "*   6. CUSTOMER SEGMENTATION ANALYSIS                *".
          05 FILLER PIC X(80) VALUE "*   7. MANAGE COMMUNICATION PREFERENCES              *".
          05 FILLER PIC X(80) VALUE "*   8. VIEW TRANSACTION HISTORY OVERVIEW             *".
          05 FILLER PIC X(80) VALUE "*                                                    *".
          05 FILLER PIC X(80) VALUE "*   X. EXIT TO MAIN MENU                             *".
          05 FILLER PIC X(80) VALUE ALL "*".

       PROCEDURE DIVISION.
       0000-MAIN-LOGIC.
           PERFORM 1000-CONTROL-LOOP UNTIL EXIT-CI-MENU.
           GOBACK.

       1000-CONTROL-LOOP.
           PERFORM 2000-DISPLAY-MENU-AND-PROMPT.
           PERFORM 3000-ACCEPT-AND-VALIDATE-CHOICE.
           IF VALID-CHOICE
               PERFORM 4000-PROCESS-CHOICE
           ELSE
               DISPLAY WS-MSG-INVALID-CHOICE
           END-IF.
           IF NOT EXIT-CI-MENU
               PERFORM 9000-PAUSE-FOR-USER
           END-IF.

       2000-DISPLAY-MENU-AND-PROMPT.
           DISPLAY " " UPON CRT. *> Clear screen (conceptual)
           DISPLAY WS-MENU-SCREEN.
           DISPLAY " "
           DISPLAY "ENTER YOUR SELECTION: " WITH NO ADVANCING.

       3000-ACCEPT-AND-VALIDATE-CHOICE.
           SET INVALID-CHOICE TO TRUE.
           ACCEPT WS-USER-CHOICE.
           MOVE FUNCTION UPPER-CASE(WS-USER-CHOICE) TO WS-USER-CHOICE.

           EVALUATE WS-USER-CHOICE
               WHEN "1" THRU "8"
                   SET VALID-CHOICE TO TRUE
               WHEN "X"
                   SET VALID-CHOICE TO TRUE
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.

       4000-PROCESS-CHOICE.
           EVALUATE WS-USER-CHOICE
               WHEN "1"
                   PERFORM 4100-HANDLE-ADD-CUSTOMER
               WHEN "2"
                   PERFORM 4200-HANDLE-INQUIRE-CUSTOMER
               WHEN "3"
                   PERFORM 4300-HANDLE-UPDATE-CUSTOMER
               WHEN "4"
                   PERFORM 4400-HANDLE-DELETE-CUSTOMER
               WHEN "5"
                   PERFORM 4500-HANDLE-AI-INSIGHTS
               WHEN "6"
                   PERFORM 4600-HANDLE-SEGMENTATION
               WHEN "7"
                   PERFORM 4700-HANDLE-COMM-PREFERENCES
               WHEN "8"
                   PERFORM 4800-HANDLE-TRANSACTION-OVERVIEW
               WHEN "X"
                   DISPLAY WS-MSG-EXITING
           END-EVALUATE.

       4100-HANDLE-ADD-CUSTOMER.
           DISPLAY " " UPON CRT.
           DISPLAY "--- ADD NEW CUSTOMER ---".
           *> CIADD is expected to handle full customer data entry.
           *> No customer ID is passed initially, as it's a new record.
           CALL "CIADD".
           DISPLAY "ADD CUSTOMER MODULE EXECUTED. Please provide new customer details in next screen.".

       4200-HANDLE-INQUIRE-CUSTOMER.
           DISPLAY " " UPON CRT.
           DISPLAY "--- INQUIRE CUSTOMER RECORD ---".
           PERFORM 5000-GET-CUSTOMER-ID.
           IF WS-CUSTOMER-ID NOT = ZEROS
               CALL "CIINQ" USING WS-CUSTOMER-ID
               DISPLAY "INQUIRE CUSTOMER MODULE EXECUTED FOR ID: " WS-CUSTOMER-ID
           ELSE
               DISPLAY "INQUIRY ABORTED DUE TO INVALID CUSTOMER ID."
           END-IF.

       4300-HANDLE-UPDATE-CUSTOMER.
           DISPLAY " " UPON CRT.
           DISPLAY "--- UPDATE CUSTOMER RECORD ---".
           PERFORM 5000-GET-CUSTOMER-ID.
           IF WS-CUSTOMER-ID NOT = ZEROS
               CALL "CIUPD" USING WS-CUSTOMER-ID
               DISPLAY "UPDATE CUSTOMER MODULE EXECUTED FOR ID: " WS-CUSTOMER-ID
           ELSE
               DISPLAY "UPDATE ABORTED DUE TO INVALID CUSTOMER ID."
           END-IF.

       4400-HANDLE-DELETE-CUSTOMER.
           DISPLAY " " UPON CRT.
           DISPLAY "--- DELETE CUSTOMER RECORD ---".
           PERFORM 5000-GET-CUSTOMER-ID.
           IF WS-CUSTOMER-ID NOT = ZEROS
               CALL "CIDEL" USING WS-CUSTOMER-ID
               DISPLAY "DELETE CUSTOMER MODULE EXECUTED FOR ID: " WS-CUSTOMER-ID
           ELSE
               DISPLAY "DELETE ABORTED DUE TO INVALID CUSTOMER ID."
           END-IF.

       4500-HANDLE-AI-INSIGHTS.
           DISPLAY " " UPON CRT.
           DISPLAY "--- COGNITIVE ANALYTICS ENGINE (CAE) INSIGHTS ---".
           PERFORM 5000-GET-CUSTOMER-ID.
           IF WS-CUSTOMER-ID NOT = ZEROS
               DISPLAY WS-MSG-PROCESSING
               INITIALIZE WS-AI-INSIGHTS-DATA *> Clear previous insights
               
               *> Call to the dedicated AI insights sub-program.
               *> It populates WS-AI-INSIGHTS-DATA based on WS-CUSTOMER-ID.
               CALL "CIAINS" USING WS-CUSTOMER-ID WS-AI-INSIGHTS-DATA

               *> Display AI-generated insights (received from CIAINS)
               DISPLAY " "
               DISPLAY "CAE INSIGHTS FOR CUSTOMER ID: " WS-CUSTOMER-ID
               DISPLAY "------------------------------------------------------------------"
               IF WS-AI-SUMMARY-LINE1 NOT = SPACES
                   DISPLAY WS-AI-SUMMARY-LINE1
                   DISPLAY WS-AI-SUMMARY-LINE2
                   DISPLAY WS-AI-SUMMARY-LINE3
                   DISPLAY WS-AI-SUMMARY-LINE4
               ELSE
                   DISPLAY WS-MSG-NO-AI-INSIGHTS
                   DISPLAY WS-MSG-AI-LEARNING
               END-IF
               DISPLAY "------------------------------------------------------------------"
               DISPLAY "AI-ASSISTED INSIGHTS MODULE EXECUTED."
           ELSE
               DISPLAY "AI INSIGHTS REQUEST ABORTED DUE TO INVALID CUSTOMER ID."
           END-IF.

       4600-HANDLE-SEGMENTATION.
           DISPLAY " " UPON CRT.
           DISPLAY "--- CUSTOMER SEGMENTATION ANALYSIS ---".
           DISPLAY WS-MSG-PROCESSING
           *> This module might run for all customers or based on specific criteria.
           CALL "CISSEG"
           DISPLAY "CUSTOMER SEGMENTATION MODULE EXECUTED. Review system reports for details.".
           *> Further interaction could involve displaying a summary of segments.

       4700-HANDLE-COMM-PREFERENCES.
           DISPLAY " " UPON CRT.
           DISPLAY "--- MANAGE COMMUNICATION PREFERENCES ---".
           PERFORM 5000-GET-CUSTOMER-ID.
           IF WS-CUSTOMER-ID NOT = ZEROS
               CALL "CIMCOM" USING WS-CUSTOMER-ID
               DISPLAY "COMMUNICATION PREFERENCES MODULE EXECUTED FOR ID: " WS-CUSTOMER-ID
           ELSE
               DISPLAY "COMMUNICATION PREFERENCE MANAGEMENT ABORTED DUE TO INVALID CUSTOMER ID."
           END-IF.

       4800-HANDLE-TRANSACTION-OVERVIEW.
           DISPLAY " " UPON CRT.
           DISPLAY "--- VIEW TRANSACTION HISTORY OVERVIEW ---".
           PERFORM 5000-GET-CUSTOMER-ID.
           IF WS-CUSTOMER-ID NOT = ZEROS
               CALL "CITRNO" USING WS-CUSTOMER-ID
               DISPLAY "TRANSACTION HISTORY OVERVIEW MODULE EXECUTED FOR ID: " WS-CUSTOMER-ID
           ELSE
               DISPLAY "TRANSACTION OVERVIEW REQUEST ABORTED DUE TO INVALID CUSTOMER ID."
           END-IF.

       5000-GET-CUSTOMER-ID.
           MOVE ZEROS TO WS-CUSTOMER-ID.
           MOVE SPACES TO WS-TEMP-CUSTOMER-ID.
           DISPLAY " " UPON CRT.
           DISPLAY WS-MSG-ENTER-CUST-ID WITH NO ADVANCING.
           ACCEPT WS-TEMP-CUSTOMER-ID.

           IF FUNCTION LENGTH(FUNCTION TRIM(WS-TEMP-CUSTOMER-ID)) = 10
               AND FUNCTION TEST-NUMVAL(FUNCTION TRIM(WS-TEMP-CUSTOMER-ID)) = 0
               MOVE WS-TEMP-CUSTOMER-ID TO WS-CUSTOMER-ID
           ELSE
               DISPLAY WS-MSG-INVALID-CUST-ID
               MOVE ZEROS TO WS-CUSTOMER-ID
           END-IF.

       9000-PAUSE-FOR-USER.
           DISPLAY " "
           DISPLAY WS-MSG-PRESS-ENTER WITH NO ADVANCING.
           ACCEPT WS-USER-CHOICE *> Dummy accept to pause and wait for user.
           .