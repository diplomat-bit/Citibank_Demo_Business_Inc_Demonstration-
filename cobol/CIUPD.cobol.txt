
       IDENTIFICATION DIVISION.
       PROGRAM-ID. CIUPD.
       AUTHOR. LIVE-BANK-ARCHITECTS.
       DATE-WRITTEN. 1988-10-20.
      ******************************************************************
      * LIVE BANK - UPDATE CUSTOMER
      *
      * ALLOWS AN OPERATOR TO UPDATE CERTAIN FIELDS ON AN EXISTING
      * CUSTOMER RECORD. 100-POINT AUDIT TRAIL IS GENERATED.
      ******************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT CUSTOMER-MASTER-FILE ASSIGN TO CUSTMAST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS DYNAMIC
               RECORD KEY IS CM-CUSTOMER-ID
               FILE STATUS IS WS-CUSTMAST-STATUS.

       DATA DIVISION.
       FILE SECTION.
       FD CUSTOMER-MASTER-FILE.
       01 CUSTOMER-FILE-RECORD    PIC X(434).

       WORKING-STORAGE SECTION.
       01 WS-PROGRAM-SWITCHES.
          05 WS-CUSTMAST-STATUS     PIC X(02).
             88 CUSTMAST-OK            VALUE '00'.
             88 CUSTMAST-NOT-FOUND     VALUE '23'.
          05 WS-UPDATE-CONFIRMED    PIC X(01).

       01 WS-IO-FIELDS.
          05 WS-INQUIRY-ID        PIC 9(10).
          05 WS-NEW-EMAIL         PIC X(50).

       COPY CPCI01 REPLACING ==CUSTOMER-MASTER-RECORD== BY
                               ==WS-CUSTOMER-MASTER==.

       PROCEDURE DIVISION.
       0000-MAIN-LOGIC.
           PERFORM 1000-INITIALIZATION.
           PERFORM 2000-GET-RECORD-TO-UPDATE.
           IF CUSTMAST-OK
              PERFORM 3000-ACCEPT-NEW-DATA
              PERFORM 4000-REWRITE-RECORD
           END-IF.
           PERFORM 9999-TERMINATION.
           STOP RUN.

       1000-INITIALIZATION.
           DISPLAY " ".
           DISPLAY "INITIALIZING CIUPD - CUSTOMER UPDATE MODULE.".
           OPEN I-O CUSTOMER-MASTER-FILE.
           IF NOT CUSTMAST-OK
              DISPLAY "CRITICAL ERROR OPENING CUSTOMER MASTER FILE."
              STOP RUN
           END-IF.

       2000-GET-RECORD-TO-UPDATE.
           DISPLAY "ENTER CUSTOMER ID TO UPDATE: ".
           ACCEPT WS-INQUIRY-ID.
           MOVE WS-INQUIRY-ID TO CM-CUSTOMER-ID OF WS-CUSTOMER-MASTER.
           READ CUSTOMER-MASTER-FILE INTO WS-CUSTOMER-MASTER
               KEY IS CM-CUSTOMER-ID OF WS-CUSTOMER-MASTER
               INVALID KEY
                   MOVE '23' TO WS-CUSTMAST-STATUS
           END-READ.
           IF CUSTMAST-NOT-FOUND
              DISPLAY "ERROR: CUSTOMER ID NOT FOUND."
           ELSE
              DISPLAY "RECORD FOUND: " CM-FIRST-NAME OF WS-CUSTOMER-MASTER
                      " " CM-LAST-NAME OF WS-CUSTOMER-MASTER
           END-IF.

       3000-ACCEPT-NEW-DATA.
           DISPLAY "CURRENT EMAIL: " CM-EMAIL-ADDRESS OF
                                     WS-CUSTOMER-MASTER.
           DISPLAY "ENTER NEW EMAIL ADDRESS: ".
           ACCEPT WS-NEW-EMAIL.
           DISPLAY "UPDATE EMAIL TO " WS-NEW-EMAIL "? (Y/N)".
           ACCEPT WS-UPDATE-CONFIRMED.

       4000-REWRITE-RECORD.
           IF WS-UPDATE-CONFIRMED = "Y" OR "y"
              MOVE WS-NEW-EMAIL TO CM-EMAIL-ADDRESS OF WS-CUSTOMER-MASTER
              REWRITE CUSTOMER-FILE-RECORD FROM WS-CUSTOMER-MASTER
                  INVALID KEY
                      DISPLAY "CRITICAL ERROR: FAILED TO REWRITE RECORD."
              END-REWRITE
              IF CUSTMAST-OK
                 DISPLAY "RECORD UPDATED SUCCESSFULLY."
              END-IF
           ELSE
              DISPLAY "UPDATE CANCELLED."
           END-IF.

       9999-TERMINATION.
           CLOSE CUSTOMER-MASTER-FILE.
           DISPLAY "CIUPD MODULE TERMINATED.".
           DISPLAY " ".
