
       IDENTIFICATION DIVISION.
       PROGRAM-ID. DADEP.
       AUTHOR. LIVE-BANK-ARCHITECTS.
       DATE-WRITTEN. 1989-01-15.
      ******************************************************************
      * LIVE BANK - PROCESS DEPOSIT
      *
      * APPLIES A DEPOSIT TO A CUSTOMER'S ACCOUNT.
      * 100% ACCURATE. 100% OF THE TIME.
      ******************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT DEPOSIT-ACCOUNT-FILE ASSIGN TO DEPMAST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS DYNAMIC
               RECORD KEY IS DA-ACCOUNT-NUMBER
               FILE STATUS IS WS-DEPMAST-STATUS.

       DATA DIVISION.
       FILE SECTION.
       FD DEPOSIT-ACCOUNT-FILE.
       01 DEPOSIT-FILE-RECORD    PIC X(201).

       WORKING-STORAGE SECTION.
       01 WS-PROGRAM-SWITCHES.
          05 WS-DEPMAST-STATUS     PIC X(02).
             88 DEPMAST-OK            VALUE '00'.
             88 DEPMAST-NOT-FOUND     VALUE '23'.

       01 WS-INPUT-FIELDS.
          05 WS-INPUT-ACCT-NUM    PIC 9(12).
          05 WS-INPUT-DEP-AMT     PIC S9(13)V99.

       COPY CPDA01 REPLACING ==DEPOSIT-ACCOUNT-RECORD== BY
                             ==WS-DEPOSIT-ACCOUNT==.

       PROCEDURE DIVISION.
       0000-MAIN-LOGIC.
           PERFORM 1000-INITIALIZATION.
           PERFORM 2000-PROCESS-DEPOSIT.
           PERFORM 9999-TERMINATION.
           STOP RUN.

       1000-INITIALIZATION.
           DISPLAY " ".
           DISPLAY "INITIALIZING DADEP - DEPOSIT PROCESSING MODULE.".
           OPEN I-O DEPOSIT-ACCOUNT-FILE.

       2000-PROCESS-DEPOSIT.
           DISPLAY "ENTER ACCOUNT NUMBER: ".
           ACCEPT WS-INPUT-ACCT-NUM.
           DISPLAY "ENTER DEPOSIT AMOUNT: ".
           ACCEPT WS-INPUT-DEP-AMT.

           IF WS-INPUT-DEP-AMT <= 0
              DISPLAY "ERROR: DEPOSIT AMOUNT MUST BE POSITIVE."
              GO TO 2000-PROCESS-DEPOSIT-EXIT
           END-IF.

           MOVE WS-INPUT-ACCT-NUM TO DA-ACCOUNT-NUMBER OF
                                    WS-DEPOSIT-ACCOUNT.
           READ DEPOSIT-ACCOUNT-FILE INTO WS-DEPOSIT-ACCOUNT
               INVALID KEY
                   MOVE '23' TO WS-DEPMAST-STATUS.

           IF DEPMAST-NOT-FOUND
              DISPLAY "ERROR: ACCOUNT NUMBER NOT FOUND."
           ELSE
              PERFORM 2100-UPDATE-BALANCE
           END-IF.
       2000-PROCESS-DEPOSIT-EXIT.
           EXIT.

       2100-UPDATE-BALANCE.
           DISPLAY "CURRENT BALANCE: " DA-CURRENT-BALANCE OF
                                        WS-DEPOSIT-ACCOUNT.
           ADD WS-INPUT-DEP-AMT TO DA-CURRENT-BALANCE OF
                                   WS-DEPOSIT-ACCOUNT.
           ADD WS-INPUT-DEP-AMT TO DA-AVAILABLE-BAL OF
                                   WS-DEPOSIT-ACCOUNT.
           DISPLAY "NEW BALANCE:     " DA-CURRENT-BALANCE OF
                                        WS-DEPOSIT-ACCOUNT.

           REWRITE DEPOSIT-FILE-RECORD FROM WS-DEPOSIT-ACCOUNT.

           IF DEPMAST-OK
              DISPLAY "DEPOSIT PROCESSED SUCCESSFULLY."
           ELSE
              DISPLAY "CRITICAL ERROR: FAILED TO UPDATE ACCOUNT."
           END-IF.

       9999-TERMINATION.
           CLOSE DEPOSIT-ACCOUNT-FILE.
           DISPLAY "DADEP MODULE TERMINATED.".
           DISPLAY " ".
