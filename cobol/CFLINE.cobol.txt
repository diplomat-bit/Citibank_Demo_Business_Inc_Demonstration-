               IDENTIFICATION DIVISION.
       PROGRAM-ID. CFLINE.
       AUTHOR. AI-DRIVEN-SYSTEMS.
      ******************************************************************
      * CREDIT FLOW MANAGEMENT - ESTABLISH CORPORATE CREDIT LINE
      * This program processes requests for new corporate credit lines.
      * It integrates a rule-based analytics module to assess risk
      * and recommend credit limits, assisting human underwriters.
      * The module provides a calculated risk score by processing
      * key financial factors to enhance decision-making consistency.
      ******************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. MAINFRAME-AI-HUB.
       OBJECT-COMPUTER. MAINFRAME-AI-HUB.

       DATA DIVISION.
       WORKING-STORAGE SECTION.

      *----------------------------------------------------------------*
      * Client Data Structure - Simulated input from a client database
      *----------------------------------------------------------------*
       01  WS-CLIENT-DATA.
           05  WS-CLIENT-ID            PIC X(10) VALUE 'CORP00123A'.
           05  WS-CLIENT-NAME          PIC X(50) VALUE 'GLOBAL INNOVATIONS CORP.'.
           05  WS-INDUSTRY-CODE        PIC X(05) VALUE 'TECH01'.
           05  WS-INDUSTRY-DESC        PIC X(30) VALUE 'TECHNOLOGY STARTUP'.
           05  WS-ANNUAL-REVENUE       PIC 9(12)V99 VALUE 25000000.00.
           05  WS-CURRENT-DEBT         PIC 9(12)V99 VALUE  5000000.00.
           05  WS-CREDIT-SCORE-EXT     PIC 9(03) VALUE 780. *> e.g., FICO-like score, 300-900
           05  WS-YEARS-IN-BUSINESS    PIC 9(02) VALUE 08.
           05  WS-DEBT-TO-EQUITY-RATIO PIC 9(03)V99 VALUE 0.75. *> Simulated, e.g., 0.00 to 2.00
           05  WS-PROFIT-MARGIN        PIC 9(02)V99 VALUE 0.15. *> Simulated, e.g., 0.00 to 0.50

      *----------------------------------------------------------------*
      * Credit Request Details
      *----------------------------------------------------------------*
       01  WS-CREDIT-REQUEST.
           05  WS-REQUESTED-AMOUNT     PIC 9(12)V99 VALUE 1000000.00.
           05  WS-REQUEST-DATE         PIC X(08) VALUE '20231026'.
           05  WS-REQUEST-TERM-MONTHS  PIC 9(03) VALUE 36.

      *----------------------------------------------------------------*
      * Risk Analysis Module Outputs
      * These fields store the results from the risk calculation model.
      *----------------------------------------------------------------*
       01  WS-AI-ANALYTICS-OUTPUT.
           05  WS-AI-RISK-SCORE        PIC 9(03)V99. *> Lower is better, 0-100 range
           05  WS-AI-RECOMMENDED-LIMIT PIC 9(12)V99.
           05  WS-AI-CONFIDENCE-LEVEL  PIC 9(02)V99. *> 0.00-1.00, model confidence in inputs
           05  WS-AI-DECISION-RATIONALE PIC X(100). *> Explains model's logic

      *----------------------------------------------------------------*
      * Final Credit Line Details
      * These fields hold the approved terms of the credit line.
      *----------------------------------------------------------------*
       01  WS-CREDIT-LINE-DETAILS.
           05  WS-APPROVED-LIMIT       PIC 9(12)V99.
           05  WS-INTEREST-RATE        PIC 9(01)V99. *> e.g., 5.75% as 5.75
           05  WS-LINE-STATUS          PIC X(10).
               88 LINE-ACTIVE          VALUE 'ACTIVE'.
               88 LINE-PENDING         VALUE 'PENDING'.
               88 LINE-REJECTED        VALUE 'REJECTED'.
           05  WS-EFFECTIVE-DATE       PIC X(08).
           05  WS-EXPIRY-DATE          PIC X(08).

      *----------------------------------------------------------------*
      * Program Status and Control Flags
      * Used for flow control and error handling within the program.
      *----------------------------------------------------------------*
       01  WS-PROGRAM-STATUS.
           05  WS-RETURN-CODE          PIC 9(04) VALUE ZEROS.
               88 SUCCESS              VALUE 0.
               88 ERROR-GENERAL        VALUE 1001.
               88 ERROR-CLIENT-DATA    VALUE 1002.
               88 ERROR-AI-PROCESS     VALUE 1003.
               88 ERROR-APPROVAL-LOGIC VALUE 1004.
           05  WS-ERROR-MESSAGE        PIC X(100) VALUE SPACES.

       01  WS-PROCESSING-FLAGS.
           05  WS-CLIENT-DATA-VALID-FLAG   PIC X(01) VALUE 'N'.
               88 CLIENT-DATA-VALID    VALUE 'Y'.
           05  WS-AI-ANALYSIS-COMPLETE-FLAG PIC X(01) VALUE 'N'.
               88 AI-ANALYSIS-COMPLETE VALUE 'Y'.
           05  WS-APPROVAL-GRANTED-FLAG    PIC X(01) VALUE 'N'.
               88 APPROVAL-GRANTED     VALUE 'Y'.

      *----------------------------------------------------------------*
      * Date Variables for calculations and current date retrieval
      *----------------------------------------------------------------*
       01  WS-CURRENT-DATE-DATA.
           05  WS-CURRENT-YEAR         PIC 9(04).
           05  WS-CURRENT-MONTH        PIC 9(02).
           05  WS-CURRENT-DAY          PIC 9(02).
       01  WS-DATE-FOR-CALC.
           05  WS-CALC-YEAR            PIC 9(04).
           05  WS-CALC-MONTH           PIC 9(02).
           05  WS-CALC-DAY             PIC 9(02).

      *----------------------------------------------------------------*
      * Generic work variables used for intermediate computations
      *----------------------------------------------------------------*
       01  WS-WORK-NUMERIC         PIC 9(18)V99.
       01  WS-WORK-FACTOR          PIC 9(03)V99.


       PROCEDURE DIVISION.
       MAIN-LOGIC.
      ******************************************************************
      * Main entry point for establishing a corporate credit line.
      * Orchestrates the entire process from data loading to final
      * approval and reporting, leveraging analysis for insights.
      * Each PERFORM statement represents a distinct phase of the
      * credit line application workflow.
      ******************************************************************
           DISPLAY '=================================================='.
           DISPLAY ' BEGINNING CORPORATE CREDIT LINE ESTABLISHMENT '.
           DISPLAY '=================================================='.

           PERFORM 1000-INITIALIZE-PROCESS.
           IF SUCCESS
               PERFORM 2000-LOAD-CLIENT-DATA
           END-IF.
           IF SUCCESS AND CLIENT-DATA-VALID
               PERFORM 3000-ANALYZE-CREDIT-REQUEST
           END-IF.
           IF SUCCESS
               PERFORM 4000-EXECUTE-RISK-ANALYSIS
           END-IF.
           IF SUCCESS AND AI-ANALYSIS-COMPLETE
               PERFORM 5000-REVIEW-AND-DECIDE
           END-IF.
           IF SUCCESS AND APPROVAL-GRANTED
               PERFORM 6000-FINALIZE-CREDIT-LINE
           END-IF.
           PERFORM 7000-GENERATE-REPORT.
           PERFORM 8000-TERMINATE-PROCESS.

           STOP RUN.

      ******************************************************************
      * 1000-INITIALIZE-PROCESS: Initializes all working storage fields
      * to their default states at the start of the program execution.
      * Also sets the effective date for the credit line.
      ******************************************************************
       1000-INITIALIZE-PROCESS.
           DISPLAY '1000-INITIALIZE-PROCESS: Initializing program variables.'.
           MOVE SPACES               TO WS-ERROR-MESSAGE.
           MOVE ZEROS                TO WS-RETURN-CODE.
           MOVE 'N'                  TO WS-CLIENT-DATA-VALID-FLAG.
           MOVE 'N'                  TO WS-AI-ANALYSIS-COMPLETE-FLAG.
           MOVE 'N'                  TO WS-APPROVAL-GRANTED-FLAG.
           MOVE ZEROS                TO WS-AI-RISK-SCORE.
           MOVE ZEROS                TO WS-AI-RECOMMENDED-LIMIT.
           MOVE ZEROS                TO WS-AI-CONFIDENCE-LEVEL.
           MOVE SPACES               TO WS-AI-DECISION-RATIONALE.
           MOVE ZEROS                TO WS-APPROVED-LIMIT.
           MOVE ZEROS                TO WS-INTEREST-RATE.
           MOVE 'PENDING'            TO WS-LINE-STATUS.
           MOVE SPACES               TO WS-EFFECTIVE-DATE.
           MOVE SPACES               TO WS-EXPIRY-DATE.

      *    Set the current date as the initial effective date
           MOVE FUNCTION CURRENT-DATE(1:8) TO WS-EFFECTIVE-DATE.
           DISPLAY 'Initialization Complete. Effective Date set to: ' WS-EFFECTIVE-DATE.
      *    Retrieve current date components for calculations later
           MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-DATE-DATA.
           MOVE WS-CURRENT-YEAR      TO WS-CALC-YEAR.
           MOVE WS-CURRENT-MONTH     TO WS-CALC-MONTH.
           MOVE WS-CURRENT-DAY       TO WS-CALC-DAY.

           IF WS-RETURN-CODE = ZEROS
               DISPLAY '1000-INITIALIZE-PROCESS: Initialized successfully.'
           ELSE
               DISPLAY '1000-INITIALIZE-PROCESS: Initialization failed with error: ' WS-ERROR-MESSAGE
           END-IF.
           .

      ******************************************************************
      * 2000-LOAD-CLIENT-DATA: Simulates loading client data.
      * In a real-world system, this would involve database queries
      * or reading from external data files based on WS-CLIENT-ID.
      * For this simulation, data is pre-populated in WS-CLIENT-DATA.
      * Basic validation is performed to ensure critical data presence.
      ******************************************************************
       2000-LOAD-CLIENT-DATA.
           DISPLAY '2000-LOAD-CLIENT-DATA: Loading client information for ' WS-CLIENT-ID '.'.
      *    Simulate data validation for key fields
           IF WS-CLIENT-ID NOT = SPACES AND
              WS-CLIENT-NAME NOT = SPACES AND
              WS-ANNUAL-REVENUE > ZEROS AND
              WS-YEARS-IN-BUSINESS > ZEROS AND
              WS-CREDIT-SCORE-EXT > ZEROS
               SET CLIENT-DATA-VALID TO TRUE
               DISPLAY 'Client Data Loaded and Validated: ' WS-CLIENT-NAME
           ELSE
               MOVE ERROR-CLIENT-DATA TO WS-RETURN-CODE
               MOVE 'Invalid or incomplete critical client data detected. Cannot proceed.' TO WS-ERROR-MESSAGE
               DISPLAY 'ERROR: ' WS-ERROR-MESSAGE
           END-IF.
           .

      ******************************************************************
      * 3000-ANALYZE-CREDIT-REQUEST: Performs initial, rule-based
      * analysis of the requested credit amount against basic client
      * financial health indicators. This pre-analysis can flag
      * significant deviations before involving the risk model.
      ******************************************************************
       3000-ANALYZE-CREDIT-REQUEST.
           DISPLAY '3000-ANALYZE-CREDIT-REQUEST: Performing initial analysis of requested amount...'.
           IF WS-REQUESTED-AMOUNT > WS-ANNUAL-REVENUE * 0.5
               DISPLAY 'WARNING: Requested amount is high relative to client''s annual revenue.'
               DISPLAY '         The risk analysis module will factor this heavily.'
           END-IF.
           IF WS-REQUESTED-AMOUNT > 5000000.00 AND WS-YEARS-IN-BUSINESS < 5
               DISPLAY 'WARNING: High requested amount for a relatively young company (<5 years).'
               DISPLAY '         The risk model will reflect increased risk for this combination.'
           END-IF.
           IF WS-REQUESTED-AMOUNT > WS-ANNUAL-REVENUE * 2
               DISPLAY 'ALERT: Requested amount is exceptionally high, exceeding 200% of annual revenue.'
               DISPLAY '       This might be an outlier or require manual override after risk analysis.'
           END-IF.
           DISPLAY 'Initial credit request analysis complete.'.
           .

      ******************************************************************
      * 4000-EXECUTE-RISK-ANALYSIS:
      * This is the core risk analysis integration point. This section
      * simulates a multi-factor model to assess credit risk. It uses
      * client financial data and request details to generate a
      * composite risk score, a recommended credit limit, and a
      * decision rationale. The model is implemented with standard
      * COBOL arithmetic to ensure deterministic, auditable results.
      ******************************************************************
       4000-EXECUTE-RISK-ANALYSIS.
           DISPLAY '4000-EXECUTE-RISK-ANALYSIS: Executing risk analysis module...'.
           DISPLAY '  Calculating risk score based on client financial metrics.'.
           DISPLAY '  Factors include: credit score, debt ratios, revenue, and industry benchmarks.'.

      *    Initialize outputs
           MOVE ZEROS TO WS-AI-RISK-SCORE.
           MOVE ZEROS TO WS-AI-RECOMMENDED-LIMIT.
           MOVE ZEROS TO WS-AI-CONFIDENCE-LEVEL.
           MOVE SPACES TO WS-AI-DECISION-RATIONALE.

      *    Simulate risk score calculation (simplified multi-factor model)
      *    The model assigns weights and combines various financial and operational
      *    metrics to derive a composite risk score.
      *    Factors considered and their impact on risk score:
      *    1. External Credit Score (higher score reduces risk significantly)
      *    2. Debt-to-Equity Ratio (higher ratio increases risk)
      *    3. Profit Margin (lower margin increases risk)
      *    4. Years in Business (fewer years increases risk due to less history)
      *    5. Requested amount relative to revenue (higher relative amount increases risk)
      *    6. Current Debt relative to revenue (higher debt increases risk)
      *    7. Industry-specific risk factors (simulated via industry code)

      *    Factor 1: External Credit Score (e.g., higher score -> lower risk contribution)
           COMPUTE WS-WORK-NUMERIC = (900 - WS-CREDIT-SCORE-EXT) / 10.00. *> Max score 900, min 300
           ADD WS-WORK-NUMERIC TO WS-AI-RISK-SCORE.

      *    Factor 2: Debt-to-Equity Ratio (e.g., 1.00 ratio -> 20 points, 0.50 -> 10 points)
           COMPUTE WS-WORK-NUMERIC = WS-DEBT-TO-EQUITY-RATIO * 20.00.
           ADD WS-WORK-NUMERIC TO WS-AI-RISK-SCORE.

      *    Factor 3: Profit Margin (e.g., 30% ideal, lower margin adds risk)
           COMPUTE WS-WORK-NUMERIC = (0.30 - WS-PROFIT-MARGIN) * 50.00.
           IF WS-WORK-NUMERIC < ZEROS THEN
               MOVE ZEROS TO WS-WORK-NUMERIC *> Cannot reduce risk below zero for this factor
           END-IF.
           ADD WS-WORK-NUMERIC TO WS-AI-RISK-SCORE.

      *    Factor 4: Years in Business (e.g., less than 5 years adds significant risk)
           COMPUTE WS-WORK-NUMERIC = (15 - WS-YEARS-IN-BUSINESS) * 2.50. *> Max risk reduction at 15+ years
           IF WS-WORK-NUMERIC < ZEROS THEN
               MOVE ZEROS TO WS-WORK-NUMERIC
           END-IF.
           ADD WS-WORK-NUMERIC TO WS-AI-RISK-SCORE.

      *    Factor 5: Requested amount to Annual Revenue Ratio
           COMPUTE WS-WORK-NUMERIC = (WS-REQUESTED-AMOUNT / WS-ANNUAL-REVENUE) * 15.00.
           ADD WS-WORK-NUMERIC TO WS-AI-RISK-SCORE.

      *    Factor 6: Current Debt to Annual Revenue Ratio
           COMPUTE WS-WORK-NUMERIC = (WS-CURRENT-DEBT / WS-ANNUAL-REVENUE) * 10.00.
           ADD WS-WORK-NUMERIC TO WS-AI-RISK-SCORE.

      *    Factor 7: Industry-specific risk adjustment (simplified)
      *    The model consults a dynamic industry risk database here.
           IF WS-INDUSTRY-CODE = 'TECH01' *> Technology startup - generally higher inherent risk
               ADD 15.00 TO WS-AI-RISK-SCORE
               MOVE 0.85 TO WS-AI-CONFIDENCE-LEVEL *> Slightly lower confidence for volatile sectors
           ELSE IF WS-INDUSTRY-CODE = 'FIN001' *> Stable financial services
               SUBTRACT 7.00 FROM WS-AI-RISK-SCORE
               MOVE 0.95 TO WS-AI-CONFIDENCE-LEVEL
           ELSE IF WS-INDUSTRY-CODE = 'MAN001' *> Manufacturing
               ADD 5.00 TO WS-AI-RISK-SCORE
               MOVE 0.90 TO WS-AI-CONFIDENCE-LEVEL
           ELSE
               ADD 10.00 TO WS-AI-RISK-SCORE *> Default for unknown/general industries
               MOVE 0.80 TO WS-AI-CONFIDENCE-LEVEL
           END-IF.

      *    Normalize and constrain risk score to 0-100 range
           IF WS-AI-RISK-SCORE < ZEROS THEN
               MOVE ZEROS TO WS-AI-RISK-SCORE
           ELSE IF WS-AI-RISK-SCORE > 100.00 THEN
               MOVE 100.00 TO WS-AI-RISK-SCORE
           END-IF.

      *    Simulate recommended limit based on normalized risk and revenue
      *    The model dynamically adjusts the multiplier based on the calculated risk.
           COMPUTE WS-WORK-FACTOR = (100.00 - WS-AI-RISK-SCORE) / 100.00.
           COMPUTE WS-AI-RECOMMENDED-LIMIT = WS-ANNUAL-REVENUE * WS-WORK-FACTOR * 0.60.
           
      *    Adjust recommendation based on the requested amount, avoiding extremes
           IF WS-AI-RECOMMENDED-LIMIT > WS-REQUESTED-AMOUNT * 1.50 THEN
      *        Model will not recommend vastly more than requested, cap it slightly higher
               COMPUTE WS-AI-RECOMMENDED-LIMIT = WS-REQUESTED-AMOUNT * 1.25
           END-IF.
           IF WS-AI-RECOMMENDED-LIMIT < WS-ANNUAL-REVENUE * 0.05 THEN
      *        Ensure a minimum sensible recommendation, even for high risk
               COMPUTE WS-AI-RECOMMENDED-LIMIT = WS-ANNUAL-REVENUE * 0.05
           END-IF.
           IF WS-AI-RECOMMENDED-LIMIT < ZEROS THEN
               MOVE ZEROS TO WS-AI-RECOMMENDED-LIMIT
           END-IF.

      *    Simulate decision rationale based on its calculated risk score
           IF WS-AI-RISK-SCORE < 30.00
               MOVE 'Assessment: Low risk. Key factors: strong financials, stable operations. High confidence in approval.'
                 TO WS-AI-DECISION-RATIONALE
           ELSE IF WS-AI-RISK-SCORE < 60.00
               MOVE 'Assessment: Moderate risk. Factors: current debt levels, sector volatility. Recommendation is risk-adjusted.'
                 TO WS-AI-DECISION-RATIONALE
           ELSE
               MOVE 'Assessment: High risk. Factors: limited history, high leverage, market conditions. Caution advised.'
                 TO WS-AI-DECISION-RATIONALE
           END-IF.

           SET AI-ANALYSIS-COMPLETE TO TRUE.
           DISPLAY '  Risk analysis complete. Results:'.
           DISPLAY '  Calculated Risk Score:   ' WS-AI-RISK-SCORE.
           DISPLAY '  Recommended Limit:       ' WS-AI-RECOMMENDED-LIMIT (B)(B) USING '$$,$$$,$$$,$$9.99'.
           DISPLAY '  Model Confidence Level:  ' WS-AI-CONFIDENCE-LEVEL.
           DISPLAY '  Decision Rationale:      ' WS-AI-DECISION-RATIONALE.
           .

      ******************************************************************
      * 5000-REVIEW-AND-DECIDE: Human oversight and final decision.
      * This section simulates an underwriter reviewing the risk analysis
      * module's recommendations and making a final decision. The model
      * provides a strong quantitative input, but the human underwriter
      * retains final authority to approve, adjust, or reject.
      ******************************************************************
       5000-REVIEW-AND-DECIDE.
           DISPLAY '5000-REVIEW-AND-DECIDE: Underwriter reviewing model recommendation and making final decision.'.
           DISPLAY '  Human discretion is applied to balance quantitative insights with strategic considerations.'.

           IF WS-AI-RISK-SCORE < 40.00 AND WS-AI-RECOMMENDED-LIMIT >= WS-REQUESTED-AMOUNT * 0.90
      *        Low risk, model recommends close to or more than requested, approve it.
               MOVE WS-REQUESTED-AMOUNT TO WS-APPROVED-LIMIT
               DISPLAY '  Model recommendation aligns with request and indicates low risk. Approving requested amount.'
               SET APPROVAL-GRANTED TO TRUE
           ELSE IF WS-AI-RISK-SCORE < 70.00 AND WS-AI-RECOMMENDED-LIMIT > ZEROS
      *        Moderate risk, approve a revised amount or model recommended.
               IF WS-AI-RECOMMENDED-LIMIT < WS-REQUESTED-AMOUNT * 0.80
                   MOVE WS-AI-RECOMMENDED-LIMIT TO WS-APPROVED-LIMIT
                   DISPLAY '  Moderate risk detected. Approving model-recommended reduced limit to manage exposure.'
               ELSE
                   MOVE WS-REQUESTED-AMOUNT TO WS-APPROVED-LIMIT
                   DISPLAY '  Moderate risk, but model supports requested amount with conditions. Approving requested amount.'
               END-IF
               SET APPROVAL-GRANTED TO TRUE
           ELSE
      *        High risk, reject or approve a very small, token amount.
               IF WS-AI-RECOMMENDED-LIMIT > 50000.00 AND WS-AI-RECOMMENDED-LIMIT < WS-REQUESTED-AMOUNT * 0.20
      *            Even with high risk, if model suggests a small, viable amount, allow it as a starting point.
                   MOVE WS-AI-RECOMMENDED-LIMIT TO WS-APPROVED-LIMIT
                   DISPLAY '  High risk identified, but model suggests a minimal viable limit. Approving reduced initial limit.'
                   SET APPROVAL-GRANTED TO TRUE
               ELSE
                   MOVE ZEROS TO WS-APPROVED-LIMIT
                   MOVE 'REJECTED' TO WS-LINE-STATUS
                   DISPLAY '  High risk detected. Request REJECTED based on critical model insights and policy.'
                   SET APPROVAL-GRANTED TO FALSE
                   IF WS-ERROR-MESSAGE = SPACES
                       MOVE 'Request rejected due to high assessed risk factors by analysis model.' TO WS-ERROR-MESSAGE
                   END-IF
               END-IF
           END-IF.

           IF APPROVAL-GRANTED
               DISPLAY '  Final Approved Limit: ' WS-APPROVED-LIMIT (B)(B) USING '$$,$$$,$$$,$$9.99'.
      *        Dynamically determine interest rate based on calculated risk score.
               IF WS-AI-RISK-SCORE < 30.00
                   MOVE 5.75 TO WS-INTEREST-RATE
               ELSE IF WS-AI-RISK-SCORE < 50.00
                   MOVE 6.50 TO WS-INTEREST-RATE
               ELSE IF WS-AI-RISK-SCORE < 70.00
                   MOVE 7.99 TO WS-INTEREST-RATE
               ELSE
                   MOVE 9.50 TO WS-INTEREST-RATE
               END-IF.
               DISPLAY '  Assigned Interest Rate: ' WS-INTEREST-RATE '%.'.
           ELSE
               MOVE ZEROS TO WS-INTEREST-RATE
           END-IF.
           .

      ******************************************************************
      * 6000-FINALIZE-CREDIT-LINE: Activates the credit line, assigns
      * a status, and calculates the expiry date based on the term.
      * This section would typically trigger updates to core banking
      * systems to establish the new credit facility.
      ******************************************************************
       6000-FINALIZE-CREDIT-LINE.
           DISPLAY '6000-FINALIZE-CREDIT-LINE: Finalizing credit line details and activating.'.
           IF APPROVAL-GRANTED
               SET LINE-ACTIVE TO TRUE
               DISPLAY '  Credit line status set to ACTIVE.'
      *        Calculate expiry date (e.g., WS-REQUEST-TERM-MONTHS from effective date)
               MOVE WS-CALC-YEAR   TO WS-DATE-FOR-CALC-YEAR.
               MOVE WS-CALC-MONTH  TO WS-DATE-FOR-CALC-MONTH.
               MOVE WS-CALC-DAY    TO WS-DATE-FOR-CALC-DAY.

      *        Perform date calculation for expiry (simplified, actual date arithmetic would use intrinsics)
               ADD WS-REQUEST-TERM-MONTHS TO WS-CALC-MONTH.
               PERFORM UNTIL WS-CALC-MONTH <= 12
                   SUBTRACT 12 FROM WS-CALC-MONTH
                   ADD 1 TO WS-CALC-YEAR
               END-PERFORM.
               
      *        Handle day overflow if the original day doesn't exist in the new month
               IF WS-CALC-DAY > FUNCTION DAYS-IN-MONTH(WS-CALC-YEAR, WS-CALC-MONTH)
                   MOVE FUNCTION DAYS-IN-MONTH(WS-CALC-YEAR, WS-CALC-MONTH) TO WS-CALC-DAY
               END-IF.

               STRING WS-CALC-YEAR
                      WS-CALC-MONTH
                      WS-CALC-DAY DELIMITED BY SIZE INTO WS-EXPIRY-DATE.
               DISPLAY '  Credit Line Effective: ' WS-EFFECTIVE-DATE.
               DISPLAY '  Credit Line Expiry:    ' WS-EXPIRY-DATE.
           ELSE
               DISPLAY '  Credit line not activated as approval was not granted. Status: ' WS-LINE-STATUS.
           END-IF.
           .

      ******************************************************************
      * 7000-GENERATE-REPORT: Displays a comprehensive summary of the
      * credit line establishment process and its final outcome.
      * This report includes client details, the original request,
      * risk analysis insights, and the final underwriting decision.
      ******************************************************************
       7000-GENERATE-REPORT.
           DISPLAY '=================================================='.
           DISPLAY '         CREDIT LINE ESTABLISHMENT REPORT         '.
           DISPLAY '=================================================='.
           DISPLAY 'CLIENT INFORMATION:'.
           DISPLAY '  Client ID:          ' WS-CLIENT-ID.
           DISPLAY '  Client Name:        ' WS-CLIENT-NAME.
           DISPLAY '  Industry:           ' WS-INDUSTRY-DESC.
           DISPLAY '  Annual Revenue:     ' WS-ANNUAL-REVENUE (B)(B) USING '$$,$$$,$$$,$$9.99'.
           DISPLAY '  Current Debt:       ' WS-CURRENT-DEBT (B)(B) USING '$$,$$$,$$$,$$9.99'.
           DISPLAY '  External Credit Score: ' WS-CREDIT-SCORE-EXT.
           DISPLAY '  Years in Business:  ' WS-YEARS-IN-BUSINESS.
           DISPLAY '--------------------------------------------------'.
           DISPLAY 'CREDIT REQUEST DETAILS:'.
           DISPLAY '  Requested Amount:   ' WS-REQUESTED-AMOUNT (B)(B) USING '$$,$$$,$$$,$$9.99'.
           DISPLAY '  Requested Term:     ' WS-REQUEST-TERM-MONTHS ' months'.
           DISPLAY '  Request Date:       ' WS-REQUEST-DATE.
           DISPLAY '--------------------------------------------------'.
           DISPLAY 'RISK ANALYSIS MODULE RESULTS:'.
           DISPLAY '  Calculated Risk Score (0-100): ' WS-AI-RISK-SCORE.
           DISPLAY '  Recommended Limit:             ' WS-AI-RECOMMENDED-LIMIT (B)(B) USING '$$,$$$,$$$,$$9.99'.
           DISPLAY '  Model Confidence Level:        ' WS-AI-CONFIDENCE-LEVEL.
           DISPLAY '  Model Rationale:               ' WS-AI-DECISION-RATIONALE.
           DISPLAY '--------------------------------------------------'.
           DISPLAY 'FINAL UNDERWRITING DECISION:'.
           DISPLAY '  Approval Status:    ' WS-LINE-STATUS.
           IF APPROVAL-GRANTED
               DISPLAY '  Approved Limit:     ' WS-APPROVED-LIMIT (B)(B) USING '$$,$$$,$$$,$$9.99'.
               DISPLAY '  Assigned Rate:      ' WS-INTEREST-RATE '%'.
               DISPLAY '  Effective Date:     ' WS-EFFECTIVE-DATE.
               DISPLAY '  Expiry Date:        ' WS-EXPIRY-DATE.
           ELSE
               DISPLAY '  Reason for Rejection: ' WS-ERROR-MESSAGE
               IF WS-ERROR-MESSAGE = SPACES
                   DISPLAY '  (Rejection based on high risk assessment and underwriting policy.)'
               END-IF.
           END-IF.
           DISPLAY '=================================================='.
           .

      ******************************************************************
      * 8000-TERMINATE-PROCESS: Handles the graceful exit of the program.
      * Displays a final status message indicating whether the process
      * completed successfully or with errors.
      ******************************************************************
       8000-TERMINATE-PROCESS.
           DISPLAY '8000-TERMINATE-PROCESS: Program termination.'.
           IF SUCCESS
               DISPLAY 'Corporate Credit Line establishment process completed successfully.'.
           ELSE
               DISPLAY 'Corporate Credit Line establishment process completed with errors: ' WS-ERROR-MESSAGE.
           END-IF.
           .