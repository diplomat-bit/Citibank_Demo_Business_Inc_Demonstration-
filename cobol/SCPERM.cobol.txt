
       IDENTIFICATION DIVISION.
       PROGRAM-ID. SCPERM.
       AUTHOR. LIVE-BANK-ARCHITECTS.
       DATE-WRITTEN. 1995-02-05.
      ******************************************************************
      * LIVE BANK - MANAGE USER PERMISSIONS
      *
      * ALLOWS A SECURITY OFFICER TO GRANT OR REVOKE PERMISSIONS
      * FOR A SYSTEM USER. 100% AUDITED.
      ******************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT SECURITY-MASTER-FILE ASSIGN TO SECMAST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS DYNAMIC
               RECORD KEY IS SEC-USER-ID.

       DATA DIVISION.
       FILE SECTION.
       FD SECURITY-MASTER-FILE.
       01 SEC-FILE-RECORD      PIC X(200).

       WORKING-STORAGE SECTION.
       01 SEC-USER-RECORD.
          05 SEC-USER-ID          PIC X(08).
          05 SEC-PERMISSIONS.
             10 SEC-CAN-VIEW-CUST  PIC X(01).
             10 SEC-CAN-EDIT-CUST  PIC X(01).
             10 SEC-CAN-RUN-BATCH  PIC X(01).
             10 SEC-IS-ADMIN       PIC X(01).

       01 WS-INPUT-FIELDS.
          05 WS-TARGET-USER       PIC X(08).
          05 WS-COMMAND           PIC X(10).
          05 WS-PERMISSION-CODE   PIC X(10).

       PROCEDURE DIVISION.
       0000-MAIN-LOGIC.
           DISPLAY " ".
           DISPLAY "SCPERM - USER PERMISSION MANAGEMENT".
           OPEN I-O SECURITY-MASTER-FILE.
           DISPLAY "ENTER USER ID TO MANAGE: ".
           ACCEPT WS-TARGET-USER.

           READ SECURITY-MASTER-FILE INTO SEC-USER-RECORD
               INVALID KEY DISPLAY "USER NOT FOUND."
                           GO TO 9999-TERMINATION.

           PERFORM 1000-DISPLAY-PERMISSIONS.
           PERFORM 2000-ACCEPT-COMMAND.

           REWRITE SEC-FILE-RECORD FROM SEC-USER-RECORD.
           DISPLAY "PERMISSIONS UPDATED.".

       9999-TERMINATION.
           CLOSE SECURITY-MASTER-FILE.
           DISPLAY "SCPERM MODULE TERMINATED.".
           DISPLAY " ".
           STOP RUN.

       1000-DISPLAY-PERMISSIONS.
           DISPLAY "CURRENT PERMISSIONS FOR " WS-TARGET-USER.
           IF SEC-CAN-VIEW-CUST = 'Y' DISPLAY "- VIEW CUSTOMERS".
           IF SEC-CAN-EDIT-CUST = 'Y' DISPLAY "- EDIT CUSTOMERS".
           IF SEC-CAN-RUN-BATCH = 'Y' DISPLAY "- RUN BATCH JOBS".
           IF SEC-IS-ADMIN = 'Y' DISPLAY "- ADMINISTRATOR".

       2000-ACCEPT-COMMAND.
           DISPLAY "ENTER COMMAND (GRANT/REVOKE) AND PERMISSION CODE: ".
           ACCEPT WS-COMMAND.
           ACCEPT WS-PERMISSION-CODE.

           EVALUATE WS-COMMAND
               WHEN "GRANT"
                   PERFORM 2100-GRANT-PERMISSION
               WHEN "REVOKE"
                   PERFORM 2200-REVOKE-PERMISSION
               WHEN OTHER
                   DISPLAY "INVALID COMMAND."
           END-EVALUATE.

       2100-GRANT-PERMISSION.
           EVALUATE WS-PERMISSION-CODE
               WHEN "VIEW-CUST" MOVE 'Y' TO SEC-CAN-VIEW-CUST
               WHEN "EDIT-CUST" MOVE 'Y' TO SEC-CAN-EDIT-CUST
               WHEN OTHER DISPLAY "INVALID PERMISSION CODE."
           END-EVALUATE.

       2200-REVOKE-PERMISSION.
           EVALUATE WS-PERMISSION-CODE
               WHEN "VIEW-CUST" MOVE 'N' TO SEC-CAN-VIEW-CUST
               WHEN "EDIT-CUST" MOVE 'N' TO SEC-CAN-EDIT-CUST
               WHEN OTHER DISPLAY "INVALID PERMISSION CODE."
           END-EVALUATE.
