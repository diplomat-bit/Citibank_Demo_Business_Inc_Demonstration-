
       IDENTIFICATION DIVISION.
       PROGRAM-ID. RPTMTH.
       AUTHOR. LIVE-BANK-ARCHITECTS.
       DATE-WRITTEN. 1994-01-02.
      ******************************************************************
      * LIVE BANK - GENERATE MONTHLY CUSTOMER STATEMENTS
      *
      * THIS IS A MASTER BATCH PROGRAM THAT DRIVES THE GENERATION
      * OF ALL CUSTOMER STATEMENTS FOR A GIVEN BILLING CYCLE.
      * PROCESSES 100,000+ ACCOUNTS.
      ******************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT CUSTOMER-MASTER-FILE ASSIGN TO CUSTMAST.

       DATA DIVISION.
       FILE SECTION.
       FD CUSTOMER-MASTER-FILE.
       01 CUSTOMER-FILE-RECORD.
          05 CM-CUSTOMER-ID       PIC 9(10).
          05 FILLER               PIC X(424).

       WORKING-STORAGE SECTION.
       01 WS-PROGRAM-SWITCHES.
          05 WS-EOF-FLAG         PIC X(01) VALUE 'N'.
             88 END-OF-FILE        VALUE 'Y'.

       01 WS-COUNTERS.
          05 WS-RECORDS-PROCESSED PIC 9(09) VALUE 0.

       PROCEDURE DIVISION.
       0000-MAIN-LOGIC.
           DISPLAY " ".
           DISPLAY "RPTMTH - MONTHLY STATEMENT BATCH JOB - STARTED".
           PERFORM 1000-INITIALIZATION.
           PERFORM 2000-PROCESS-CUSTOMERS UNTIL END-OF-FILE.
           PERFORM 3000-FINALIZE-JOB.
           STOP RUN.

       1000-INITIALIZATION.
           OPEN INPUT CUSTOMER-MASTER-FILE.
           READ CUSTOMER-MASTER-FILE
               AT END SET END-OF-FILE TO TRUE
           END-READ.

       2000-PROCESS-CUSTOMERS.
           ADD 1 TO WS-RECORDS-PROCESSED.
           IF (FUNCTION MOD(WS-RECORDS-PROCESSED, 100)) = 0
              DISPLAY "PROCESSED " WS-RECORDS-PROCESSED " CUSTOMERS..."
           END-IF.

      *    FOR EACH CUSTOMER, CALL THE INDIVIDUAL STATEMENT
      *    GENERATION PROGRAM. THIS IS A COMMON BATCH PATTERN.
      *    (THIS IS A SIMULATION - WE WOULD NEED TO CHECK FOR
      *     CARD ACCOUNTS, DEPOSIT ACCOUNTS, ETC.)
           CALL "CRSTMT" USING CM-CUSTOMER-ID.

           READ CUSTOMER-MASTER-FILE
               AT END SET END-OF-FILE TO TRUE
           END-READ.

       3000-FINALIZE-JOB.
           CLOSE CUSTOMER-MASTER-FILE.
           DISPLAY " ".
           DISPLAY "MONTH-END STATEMENT GENERATION COMPLETE.".
           DISPLAY "TOTAL CUSTOMERS PROCESSED: " WS-RECORDS-PROCESSED.
           DISPLAY "RPTMTH - BATCH JOB - FINISHED".
           DISPLAY " ".
