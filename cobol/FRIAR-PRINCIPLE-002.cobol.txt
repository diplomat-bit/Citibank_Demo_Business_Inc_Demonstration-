
       IDENTIFICATION DIVISION.
       PROGRAM-ID. UNQUESTIONABLE-RECORD.
       AUTHOR. THE-ARCHITECT.
      ******************************************************************
      * FRIAR PRINCIPLE 002: THE UNQUESTIONABLE RECORD.
      * EVERY ACTION MUST BE RECORDED IN AN IMMUTABLE LEDGER.
      * THE PAST IS STONE. IT CAN BE READ, NOT REWRITTEN.
      * 100 ENTRIES PER BLOCK, 100 BLOCKS PER CHAIN.
      ******************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT LEDGER-FILE ASSIGN TO "LEDGER.DAT"
           ORGANIZATION IS SEQUENTIAL
           ACCESS MODE IS SEQUENTIAL.
       DATA DIVISION.
       FILE SECTION.
       FD LEDGER-FILE.
       01 LEDGER-RECORD.
          05 LR-TIMESTAMP      PIC X(27).
          05 LR-ACTION-ID      PIC X(10).
          05 LR-ACTION-HASH    PIC X(64).

       WORKING-STORAGE SECTION.
       01 WS-NEW-TRANSACTION.
          05 WS-TX-TIMESTAMP   PIC X(27).
          05 WS-TX-ACTION-ID   PIC X(10) VALUE 'TXN-100'.
          05 WS-TX-DATA        PIC X(100) VALUE 'PAYMENT OF 100 TO ACME'.
       01 WS-TX-HASH          PIC X(64).

       PROCEDURE DIVISION.
       MAIN-LOGIC.
           OPEN EXTEND LEDGER-FILE.
           PERFORM GENERATE-HASH.
           PERFORM WRITE-TO-LEDGER.
           CLOSE LEDGER-FILE.
           STOP RUN.

       GENERATE-HASH.
      *    (SIMULATES A CRYPTOGRAPHIC HASH FUNCTION)
           MOVE FUNCTION CURRENT-DATE TO WS-TX-TIMESTAMP.
           STRING WS-TX-TIMESTAMP DELIMITED BY SIZE
                  WS-TX-ACTION-ID DELIMITED BY SIZE
                  WS-TX-DATA DELIMITED BY SIZE
                  INTO WS-TX-HASH.
      *    (IN A REAL SYSTEM, A CALL TO A HASHING LIBRARY WOULD BE MADE)
           DISPLAY "HASH GENERATED FOR ACTION: " WS-TX-HASH.

       WRITE-TO-LEDGER.
           MOVE WS-TX-TIMESTAMP TO LR-TIMESTAMP.
           MOVE WS-TX-ACTION-ID TO LR-ACTION-ID.
           MOVE WS-TX-HASH      TO LR-ACTION-HASH.
           WRITE LEDGER-RECORD.
           DISPLAY "ACTION WRITTEN TO IMMUTABLE LEDGER.".
