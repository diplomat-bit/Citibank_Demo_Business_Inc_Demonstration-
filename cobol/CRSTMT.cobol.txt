
       IDENTIFICATION DIVISION.
       PROGRAM-ID. CRSTMT.
       AUTHOR. LIVE-BANK-ARCHITECTS.
       DATE-WRITTEN. 1992-01-20.
      ******************************************************************
      * LIVE BANK - GENERATE CARDHOLDER STATEMENT
      *
      * GENERATES A MONTHLY STATEMENT FOR A GIVEN CARDHOLDER,
      * INCLUDING ALL TRANSACTIONS AND A SUMMARY OF CHARGES.
      ******************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT CARDHOLDER-MASTER-FILE ASSIGN TO CARDMAST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS RANDOM
               RECORD KEY IS CR-CARD-NUMBER.
           SELECT TRANSACTION-FILE ASSIGN TO TRANLOG.
           SELECT STATEMENT-FILE ASSIGN TO STMTOUT.

       DATA DIVISION.
       FILE SECTION.
       FD CARDHOLDER-MASTER-FILE.
       01 CARD-FILE-RECORD    PIC X(114).
       FD TRANSACTION-FILE.
       01 TX-RECORD           PIC X(80).
       FD STATEMENT-FILE.
       01 STMT-LINE           PIC X(132).

       WORKING-STORAGE SECTION.
       01 WS-INPUT-CARD-NUMBER   PIC 9(16).
       01 WS-EOF-FLAG            PIC X(01) VALUE 'N'.
          88 END-OF-TRANSACTIONS  VALUE 'Y'.
       COPY CPCR01.
       01 WS-STATEMENT-HEADER.
          05 FILLER             PIC X(20) VALUE 'STATEMENT FOR CARD: '.
          05 ST-CARD-NUM        PIC 9(16).
       01 WS-TRANSACTION-LINE.
          05 ST-TX-DATE         PIC X(10).
          05 FILLER             PIC X(05) VALUE SPACES.
          05 ST-TX-DESC         PIC X(50).
          05 ST-TX-AMOUNT       PIC $$$,$$9.99.

       PROCEDURE DIVISION.
       0000-MAIN-LOGIC.
           OPEN INPUT CARDHOLDER-MASTER-FILE, TRANSACTION-FILE.
           OPEN OUTPUT STATEMENT-FILE.
           DISPLAY "ENTER CARD NUMBER FOR STATEMENT GENERATION: ".
           ACCEPT WS-INPUT-CARD-NUMBER.
           PERFORM 1000-READ-CARDHOLDER.
           PERFORM 2000-WRITE-STATEMENT-HEADER.
           PERFORM 3000-PROCESS-TRANSACTIONS
               UNTIL END-OF-TRANSACTIONS.
           PERFORM 4000-WRITE-SUMMARY.
           CLOSE CARDHOLDER-MASTER-FILE, TRANSACTION-FILE, STATEMENT-FILE.
           DISPLAY "STATEMENT GENERATED.".
           STOP RUN.

       1000-READ-CARDHOLDER.
           MOVE WS-INPUT-CARD-NUMBER TO CR-CARD-NUMBER.
           READ CARDHOLDER-MASTER-FILE
               INVALID KEY DISPLAY "CARD NOT FOUND" STOP RUN.

       2000-WRITE-STATEMENT-HEADER.
           MOVE CR-CARD-NUMBER TO ST-CARD-NUM.
           WRITE STMT-LINE FROM WS-STATEMENT-HEADER.
           WRITE STMT-LINE FROM " ".

       3000-PROCESS-TRANSACTIONS.
           READ TRANSACTION-FILE
               AT END SET END-OF-TRANSACTIONS TO TRUE
           END-READ.
           IF NOT END-OF-TRANSACTIONS
      *        (LOGIC TO CHECK IF TX-RECORD BELONGS TO CARDHOLDER
      *         AND IS IN THE CORRECT BILLING CYCLE)
               MOVE "2024-07-27" TO ST-TX-DATE
               MOVE "SOME MERCHANT" TO ST-TX-DESC
               MOVE 123.45 TO ST-TX-AMOUNT
               WRITE STMT-LINE FROM WS-TRANSACTION-LINE
           END-IF.

       4000-WRITE-SUMMARY.
           DISPLAY "WRITING STATEMENT SUMMARY...".
      *    (LOGIC TO CALCULATE AND WRITE TOTALS, MIN PAYMENT, ETC)
           WRITE STMT-LINE FROM "END OF STATEMENT".
