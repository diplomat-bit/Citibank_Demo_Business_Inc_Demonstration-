
       IDENTIFICATION DIVISION.
       PROGRAM-ID. FTINIT.
       AUTHOR. LIVE-BANK-ARCHITECTS.
       DATE-WRITTEN. 1993-02-10.
      ******************************************************************
      * LIVE BANK - INITIATE FUNDS TRANSFER
      *
      * INITIATES A WIRE OR ACH TRANSFER, PERFORMS COMPLIANCE
      * CHECKS, AND LOGS TO THE LEDGER.
      ******************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT FUNDS-TRANSFER-FILE ASSIGN TO FTMAST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS DYNAMIC
               RECORD KEY IS FT-TRANSACTION-ID
               FILE STATUS IS WS-FTMAST-STATUS.
           SELECT DEPOSIT-ACCOUNT-FILE ASSIGN TO DEPMAST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS RANDOM
               RECORD KEY IS DA-ACCOUNT-NUMBER
               FILE STATUS IS WS-DEPMAST-STATUS.

       DATA DIVISION.
       FILE SECTION.
       FD FUNDS-TRANSFER-FILE.
       01 FT-FILE-RECORD         PIC X(200).
       FD DEPOSIT-ACCOUNT-FILE.
       01 DEPOSIT-FILE-RECORD    PIC X(201).


       WORKING-STORAGE SECTION.
       01 WS-PROGRAM-SWITCHES.
          05 WS-FTMAST-STATUS       PIC X(02).
             88 FTMAST-OK            VALUE '00'.
          05 WS-DEPMAST-STATUS      PIC X(02).
             88 DEPMAST-OK            VALUE '00'.
             88 DEPMAST-NOT-FOUND     VALUE '23'.
          05 WS-VALIDATION-FLAG     PIC X(01) VALUE 'N'.
             88 VALIDATION-PASSED      VALUE 'Y'.

       COPY CPFT01 REPLACING ==FUNDS-TRANSFER-RECORD== BY
                             ==WS-FUNDS-TRANSFER==.
       COPY CPDA01.

       PROCEDURE DIVISION.
       0000-MAIN-LOGIC.
           PERFORM 1000-INITIALIZATION.
           PERFORM 2000-ACCEPT-TRANSFER-DATA.
           PERFORM 3000-VALIDATE-ACCOUNTS.
           IF VALIDATION-PASSED
              PERFORM 4000-COMPLIANCE-SCREEN
              PERFORM 5000-WRITE-TRANSFER-RECORD
           END-IF.
           PERFORM 9999-TERMINATION.
           STOP RUN.

       1000-INITIALIZATION.
           DISPLAY " ".
           DISPLAY "INITIALIZING FTINIT - FUNDS TRANSFER INITIATION.".
           OPEN I-O FUNDS-TRANSFER-FILE.
           OPEN INPUT DEPOSIT-ACCOUNT-FILE.

       2000-ACCEPT-TRANSFER-DATA.
           DISPLAY "ENTER FROM ACCOUNT: ".
           ACCEPT FT-FROM-ACCOUNT OF WS-FUNDS-TRANSFER.
           DISPLAY "ENTER TO ACCOUNT: ".
           ACCEPT FT-TO-ACCOUNT OF WS-FUNDS-TRANSFER.
           DISPLAY "ENTER AMOUNT: ".
           ACCEPT FT-TRANSFER-AMOUNT OF WS-FUNDS-TRANSFER.

       3000-VALIDATE-ACCOUNTS.
           DISPLAY "VALIDATING ORIGINATOR ACCOUNT...".
           MOVE FT-FROM-ACCOUNT OF WS-FUNDS-TRANSFER TO DA-ACCOUNT-NUMBER.
           READ DEPOSIT-ACCOUNT-FILE INTO DEPOSIT-ACCOUNT-RECORD
               INVALID KEY MOVE '23' TO WS-DEPMAST-STATUS.

           IF DEPMAST-NOT-FOUND
              DISPLAY "ERROR: ORIGINATOR ACCOUNT NOT FOUND."
           ELSE
              IF NOT DA-IS-ACTIVE
                 DISPLAY "ERROR: ORIGINATOR ACCOUNT IS NOT ACTIVE."
              ELSE
                 IF FT-TRANSFER-AMOUNT > DA-AVAILABLE-BAL
                    DISPLAY "ERROR: INSUFFICIENT FUNDS IN ORIGINATOR."
                 ELSE
                    DISPLAY "ORIGINATOR ACCOUNT AND FUNDS VERIFIED."
                    SET VALIDATION-PASSED TO TRUE
                 END-IF
              END-IF
           END-IF.

       4000-COMPLIANCE-SCREEN.
           DISPLAY "CALLING AI FOR 100-POINT COMPLIANCE SCREEN (AML/OFAC)".
           CALL "AI-INTEGRATION-LAYER" USING WS-FUNDS-TRANSFER
                                       GIVING FT-COMPLIANCE-FLAGS.
           DISPLAY "COMPLIANCE SCREEN PASSED.".

       5000-WRITE-TRANSFER-RECORD.
           MOVE "FT-2024-00001" TO FT-TRANSACTION-ID OF WS-FUNDS-TRANSFER.
           SET FT-PENDING OF WS-FUNDS-TRANSFER TO TRUE.
           WRITE FT-FILE-RECORD FROM WS-FUNDS-TRANSFER.
           IF FTMAST-OK
              DISPLAY "FUNDS TRANSFER INITIATED AND PENDING."
           ELSE
              DISPLAY "CRITICAL ERROR: FAILED TO LOG TRANSFER."
           END-IF.

       9999-TERMINATION.
           CLOSE FUNDS-TRANSFER-FILE, DEPOSIT-ACCOUNT-FILE.
           DISPLAY "FTINIT MODULE TERMINATED.".
           DISPLAY " ".
