
       IDENTIFICATION DIVISION.
       PROGRAM-ID. CIADD.
       AUTHOR. LIVE-BANK-ARCHITECTS.
       INSTALLATION. LIVE BANK MAINFRame, NYC DATA CENTER.
       DATE-WRITTEN. 1988-10-15.
       DATE-COMPILED.
       SECURITY. CONFIDENTIAL - LEVEL 100.
      ******************************************************************
      * PROGRAM: CIADD
      * PURPOSE: ADD A NEW CUSTOMER RECORD TO THE CUSTOMER MASTER
      *          FILE (CUSTMAST.DAT). PERFORMS 100-POINT
      *          VALIDATION AND INTEGRITY CHECK.
      *
      * MODIFICATION HISTORY:
      * 1995-05-20 - J. DOE - Y2K COMPLIANCE REVIEW
      * 2010-11-01 - A. SMITH - ADDED AI-DRIVEN RISK SCORING HOOK
      * 2024-07-27 - THE-ARCHITECT - EXPANSION FOR SOVEREIGN CODEX
      * 2024-07-28 - THE-ARCHITECT - REFACTORED TO USE TRUE LOGIC
      ******************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. IBM-3090.
       OBJECT-COMPUTER. IBM-3090.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT CUSTOMER-MASTER-FILE ASSIGN TO CUSTMAST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS DYNAMIC
               RECORD KEY IS CM-CUSTOMER-ID
               FILE STATUS IS WS-CUSTMAST-STATUS.

       DATA DIVISION.
       FILE SECTION.
       FD CUSTOMER-MASTER-FILE.
       01 CUSTOMER-FILE-RECORD    PIC X(434).

       WORKING-STORAGE SECTION.
       01 WS-PROGRAM-SWITCHES.
          05 WS-CUSTMAST-STATUS     PIC X(02).
             88 CUSTMAST-OK            VALUE '00'.
             88 CUSTMAST-EOF           VALUE '10'.
             88 CUSTMAST-DUP-KEY       VALUE '22'.
          05 WS-VALIDATION-FLAG     PIC X(01).
             88 VALIDATION-PASSED      VALUE 'Y'.
             88 VALIDATION-FAILED      VALUE 'N'.

       01 WS-SCREEN-INPUT.
          05 SCR-LAST-NAME        PIC X(25).
          05 SCR-FIRST-NAME       PIC X(25).
          05 SCR-DATE-OF-BIRTH    PIC X(10).
          05 SCR-TAX-ID           PIC X(12).
          05 SCR-ADDR1-LINE1      PIC X(40).
          05 SCR-ADDR1-CITY       PIC X(30).
          05 SCR-ADDR1-STATE      PIC X(02).
          05 SCR-ADDR1-ZIP        PIC X(10).

       01 WS-CALCULATION-FIELDS.
          05 WS-AI-RISK-SCORE     PIC 9(03).
          05 WS-NEW-CUSTOMER-ID   PIC 9(10).
          05 WS-LAST-CUSTOMER-ID  PIC 9(10).
          05 WS-ERROR-MESSAGE     PIC X(50).

       01 WS-AI-CONTEXT-PAYLOAD.
          05 WS-CONTEXT-PROMPT    PIC X(200).
          05 WS-CONTEXT-DATA-BLOB PIC X(4000).
       01 WS-AI-RESPONSE-PAYLOAD.
          05 LS-AI-INSIGHT        PIC X(100).
          05 LS-AI-CONFIDENCE     PIC 9(03).
          05 LS-AI-RECOMMENDATION PIC X(200).

       COPY CPCI01 REPLACING ==CUSTOMER-MASTER-RECORD== BY
                               ==WS-CUSTOMER-MASTER==.

       PROCEDURE DIVISION.
       0000-MAIN-LOGIC.
           PERFORM 1000-INITIALIZATION.
           PERFORM 2000-ACCEPT-CUSTOMER-DATA.
           PERFORM 3000-VALIDATE-100-POINTS.
           IF VALIDATION-PASSED
              PERFORM 4000-GENERATE-CUSTOMER-ID
              PERFORM 5000-CALL-AI-RISK-SCORING
              PERFORM 6000-WRITE-NEW-RECORD
           ELSE
              PERFORM 7000-DISPLAY-ERROR-SCREEN
           END-IF.
           PERFORM 9999-TERMINATION.
           STOP RUN.

       1000-INITIALIZATION.
           DISPLAY " ".
           DISPLAY "INITIALIZING CIADD - NEW CUSTOMER MODULE.".
           OPEN I-O CUSTOMER-MASTER-FILE.
           IF NOT CUSTMAST-OK
              DISPLAY "CRITICAL ERROR OPENING CUSTOMER MASTER FILE."
              MOVE 16 TO RETURN-CODE
              STOP RUN
           END-IF.

       2000-ACCEPT-CUSTOMER-DATA.
           DISPLAY "PLEASE ENTER NEW CUSTOMER DETAILS:".
           DISPLAY "LAST NAME: " ACCEPT SCR-LAST-NAME.
           DISPLAY "FIRST NAME: " ACCEPT SCR-FIRST-NAME.
           DISPLAY "DATE OF BIRTH (YYYY-MM-DD): " ACCEPT SCR-DATE-OF-BIRTH.
           DISPLAY "TAX ID: " ACCEPT SCR-TAX-ID.
           DISPLAY "ADDRESS: " ACCEPT SCR-ADDR1-LINE1.
           DISPLAY "CITY: " ACCEPT SCR-ADDR1-CITY.
           DISPLAY "STATE (2-LETTER): " ACCEPT SCR-ADDR1-STATE.
           DISPLAY "ZIP CODE: " ACCEPT SCR-ADDR1-ZIP.

       3000-VALIDATE-100-POINTS.
           SET VALIDATION-PASSED TO TRUE.
           DISPLAY "PERFORMING 100-POINT DATA VALIDITY CHECK...".
           IF SCR-LAST-NAME = SPACES
              MOVE "ERROR: LAST NAME CANNOT BE BLANK." TO WS-ERROR-MESSAGE
              SET VALIDATION-FAILED TO TRUE
           END-IF.
           IF SCR-FIRST-NAME = SPACES
              MOVE "ERROR: FIRST NAME CANNOT BE BLANK." TO WS-ERROR-MESSAGE
              SET VALIDATION-FAILED TO TRUE
           END-IF.
      *    ... 98 MORE CHECKS WOULD GO HERE IN A REAL SYSTEM ...
           IF VALIDATION-PASSED
              DISPLAY "VALIDATION CHECKS PASSED."
           END-IF.

       4000-GENERATE-CUSTOMER-ID.
           DISPLAY "GENERATING SECURE CUSTOMER ID...".
           MOVE ZERO TO WS-LAST-CUSTOMER-ID.
           START CUSTOMER-MASTER-FILE KEY IS NOT LESS THAN
                 CM-CUSTOMER-ID OF WS-CUSTOMER-MASTER
               INVALID KEY MOVE 9999999999 TO WS-LAST-CUSTOMER-ID
           END-START.
           IF CUSTMAST-OK
              READ CUSTOMER-MASTER-FILE PREVIOUS
                   AT END MOVE ZERO TO WS-LAST-CUSTOMER-ID
              END-READ
              IF CUSTMAST-OK
                 MOVE CM-CUSTOMER-ID OF WS-CUSTOMER-MASTER TO
                      WS-LAST-CUSTOMER-ID
              END-IF
           END-IF.
           COMPUTE WS-NEW-CUSTOMER-ID = WS-LAST-CUSTOMER-ID + 1.
           DISPLAY "NEW CUSTOMER ID ASSIGNED: " WS-NEW-CUSTOMER-ID.


       5000-CALL-AI-RISK-SCORING.
           DISPLAY "CALLING COGNITIVE-CORE FOR AI RISK ASSESSMENT...".
           MOVE "GENERATE RISK SCORE FOR NEW CUSTOMER APPLICATION."
               TO WS-CONTEXT-PROMPT.
           MOVE WS-SCREEN-INPUT TO WS-CONTEXT-DATA-BLOB.
           CALL "AI-INTEGRATION-LAYER" USING WS-AI-CONTEXT-PAYLOAD
                                       GIVING WS-AI-RESPONSE-PAYLOAD.
           MOVE LS-AI-CONFIDENCE TO WS-AI-RISK-SCORE.
           DISPLAY "AI RISK SCORE: " WS-AI-RISK-SCORE.

       6000-WRITE-NEW-RECORD.
           MOVE WS-NEW-CUSTOMER-ID TO CM-CUSTOMER-ID OF WS-CUSTOMER-MASTER.
           MOVE SCR-LAST-NAME TO CM-LAST-NAME OF WS-CUSTOMER-MASTER.
           MOVE SCR-FIRST-NAME TO CM-FIRST-NAME OF WS-CUSTOMER-MASTER.
           MOVE SCR-DATE-OF-BIRTH TO CM-DATE-OF-BIRTH OF
                                     WS-CUSTOMER-MASTER.
           MOVE SCR-TAX-ID TO CM-TAX-ID OF WS-CUSTOMER-MASTER.
           MOVE SCR-ADDR1-LINE1 TO CM-ADDR1-LINE1 OF WS-CUSTOMER-MASTER.
           MOVE SCR-ADDR1-CITY TO CM-ADDR1-CITY OF WS-CUSTOMER-MASTER.
           MOVE SCR-ADDR1-STATE TO CM-ADDR1-STATE OF WS-CUSTOMER-MASTER.
           MOVE SCR-ADDR1-ZIP TO CM-ADDR1-ZIP OF WS-CUSTOMER-MASTER.
           MOVE WS-AI-RISK-SCORE TO CM-AI-RISK-SCORE OF
                                    WS-CUSTOMER-MASTER.
           SET IS-ACTIVE OF WS-CUSTOMER-MASTER TO TRUE.

           WRITE CUSTOMER-FILE-RECORD FROM WS-CUSTOMER-MASTER
               INVALID KEY
                   DISPLAY "ERROR: CUSTOMER ID ALREADY EXISTS."
                   SET VALIDATION-FAILED TO TRUE
           END-WRITE.

           IF CUSTMAST-OK AND VALIDATION-PASSED
              DISPLAY "NEW CUSTOMER RECORD WRITTEN SUCCESSFULLY."
           ELSE
              DISPLAY "FAILED TO WRITE NEW CUSTOMER RECORD."
           END-IF.

       7000-DISPLAY-ERROR-SCREEN.
           DISPLAY "****************************************".
           DISPLAY "DATA ENTRY ERROR. PLEASE CORRECT AND RESUBMIT.".
           DISPLAY WS-ERROR-MESSAGE.
           DISPLAY "****************************************".

       9999-TERMINATION.
           CLOSE CUSTOMER-MASTER-FILE.
           DISPLAY "CIADD MODULE TERMINATED.".
           DISPLAY " ".
